# Government Variety Pack
# Events - Sublight Empire / Commonwealth
# Author: littleraskol

namespace = lrsk_gov_var_sublight_origins

# Sets up the vassals
country_event = {
	id = lrsk_gov_var_sublight_origins.1
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
	}

	immediate = {
		# Using variables to catch gauranteed ideal worlds.
		# lrsk_gcol = number of guaranteed colonies.
		# lrsk_rcol = number of randomly generated colonies we need to make good.
		if = {
			limit = { num_guaranteed_colonies > 2 }
			set_variable = { which = lrsk_gcol value = 3 }
			set_variable = { which = lrsk_rcol value = 0 } # Technically this does nothing but eh explicitness...
		}
		else_if = {
			limit = { num_guaranteed_colonies = 2 }
			set_variable = { which = lrsk_gcol value = 2 }
			set_variable = { which = lrsk_rcol value = 1 }
		}
		else_if = {
			limit = { num_guaranteed_colonies = 1 }
			set_variable = { which = lrsk_gcol value = 1 }
			set_variable = { which = lrsk_rcol value = 2 }
		}
		else = {
			set_variable = { which = lrsk_gcol value = 0 } # Technically this does nothing but eh explicitness...
			set_variable = { which = lrsk_rcol value = 3 }
		}

		log = "Num of g. colonies = [this.lrsk_gcol]"
		log = "Num of r. colonies =  [this.lrsk_rcol]"

		this = { save_event_target_as = lrsk_sublight_overlord }
		owner_species = { save_event_target_as = lrsk_sublight_overlord_species }

		capital_scope = { solar_system = {
			# Transferring variables
			set_variable = { which = lrsk_gcol value = prevprev } 
			set_variable = { which = lrsk_rcol value = prevprev }

			log = "Switched to capital system [this.GetName], num of g. colonies = [this.lrsk_gcol]"
			log = "Switched to capital system [this.GetName], num of r. colonies =  [this.lrsk_rcol]"


			# This will flag three planets as potential sublight colonies
			# Will check for any ideal planets and flag them first.
			# Will make up the difference with random normal planets flagged to be reformed.		
			while = {
				count = 3 # The max num of times we ever want to do this
				log = "Starting gcol flagger..."
				IF = {
					limit = {
						check_variable = {
							which = lrsk_gcol
							value > 0
						}
					}
					log = "In gcol flagger, num to flag = [this.lrsk_gcol]"
					closest_system = { 
						limit = {
							has_owner = no
							NOT = { star = { has_planet_flag = lrsk_sublight_colony_system } }
							any_system_planet = { has_planet_flag = prescripted_ideal }
						}

						log = "gcol flagger: found ideal colony in [this.GetName]"
						random_system_planet = { limit = { has_planet_flag = prescripted_ideal }
							log = "gcol flagger: flagging planet [this.GetName]"
							set_planet_flag = lrsk_sublight_colony_planet
						}
						star = { set_planet_flag = lrsk_sublight_colony_system } # ensures that systems with more than one eligible world don't get more than one tagged world
					}
					subtract_variable = {
						which = lrsk_gcol
						value = 1
					}
				}
				log = "gcol flagger loop completed."
			}			
			
			while = {
				count = 3 # The max num of times we ever want to do this
				log = "Starting rcol flagger..."
				IF = {
					limit = {
						check_variable = {
							which = lrsk_rcol
							value > 0
						}
					}
					log = "In rcol flagger, num to flag = [this.lrsk_rcol]"
					closest_system = {
						limit = {
							NOT = { star = { has_planet_flag = lrsk_sublight_colony_system } }
							has_owner = no
							any_system_planet = {
								is_ringworld = no
								is_asteroid = no
								is_star = no
								is_moon = no
							}
						}
						log = "rcol flagger: found suitable colony candidate in [this.GetName]"
						random_system_planet = { 
							limit = {
								is_ringworld = no
								is_asteroid = no
								is_star = no
								is_moon = no
							}
							log = "rcol flagger: flagging planet [this.GetName]"
							set_planet_flag = lrsk_sublight_colony_planet
							set_planet_flag = lrsk_sublight_reform_planet
						}
						star = { set_planet_flag = lrsk_sublight_colony_system } # ensures that systems with more than one eligible world don't get more than one tagged world
					}
					subtract_variable = {
						which = lrsk_rcol
						value = 1
					}
				}
				log = "rcol flagger loop completed."
			}

			# Look at all the systems we flagged, catch and reform all planets flagged for reform.
			while = {
				count = 3
				log = "In rcol reformer"
				closest_system = {
					limit = { star = { has_planet_flag = lrsk_sublight_colony_system } }
					log = "In rcol reformer; found sublight system: [this.GetName]"
					IF = {
						limit = { any_system_planet = { has_planet_flag = lrsk_sublight_reform_planet } }
						random_system_planet = { limit = { has_planet_flag = lrsk_sublight_reform_planet }
							log = "In rcol reformer; found planet to reform: [this.GetName]"
							set_planet_size = 16
							if = {
								limit = { event_target:lrsk_sublight_overlord = { ideal_planet_class = pc_arid } }
								change_pc = pc_arid
							}
							else_if = {
								limit = { event_target:lrsk_sublight_overlord = { ideal_planet_class = pc_desert } }
								change_pc = pc_desert
							}
							else_if = {
								limit = { event_target:lrsk_sublight_overlord = { ideal_planet_class = pc_tropical } }
								change_pc = pc_tropical
							}
							else_if = {
								limit = { event_target:lrsk_sublight_overlord = { ideal_planet_class = pc_ocean } }
								change_pc = pc_ocean
							}
							else_if = {
								limit = { event_target:lrsk_sublight_overlord = { ideal_planet_class = pc_tundra } }
								change_pc = pc_tundra
							}
							else_if = {
								limit = { event_target:lrsk_sublight_overlord = { ideal_planet_class = pc_arctic } }
								change_pc = pc_arctic
							}
							else_if = {
								limit = { event_target:lrsk_sublight_overlord = { ideal_planet_class = pc_alpine } }
								change_pc = pc_alpine
							}
							else_if = {
								limit = { event_target:lrsk_sublight_overlord = { ideal_planet_class = pc_savannah } }
								change_pc = pc_savannah
							}
							# If all else fails, try continental (also this will catch continental)
							else = { change_pc = pc_continental }
							reroll_planet = yes
							remove_planet_flag = lrsk_sublight_reform_planet
						}
					}
					star = { remove_planet_flag = lrsk_sublight_colony_system }
				}
			}

			# Create dissidents
			closest_system = { limit = { any_system_planet = { has_planet_flag = lrsk_sublight_colony_planet } }
				log = "Creating dissident system: [this.GetName]"
				random_system_planet = { limit = { has_planet_flag = lrsk_sublight_colony_planet }
					log = "Creating dissident colony on: [this.GetName]"
					remove_planet_flag = lrsk_sublight_colony_planet
					set_planet_flag = lrsk_sublight_dissident_homeworld

					# I can't believe I am doing this dumb shit
					event_target:lrsk_sublight_overlord = {
						log = "Doing total bullshit!!!!!!"
						IF = {
							limit = { OR = {
								has_ethic = ethic_authoritarian
								has_ethic = ethic_fanatic_authoritarian 
							} }
							switch = {
								trigger = has_ethic
								ethic_xenophobe = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_xenophile"
											ethic = "ethic_fanatic_egalitarian"
										}
									}
								}
								ethic_xenophile = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_xenophobe"
											ethic = "ethic_fanatic_egalitarian"
										}
									}
								}
								ethic_materialist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_spiritualist"
											ethic = "ethic_fanatic_egalitarian"
										}
									}
								}
								ethic_spiritualist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_materialist"
											ethic = "ethic_fanatic_egalitarian"
										}
									}
								}
								ethic_militarist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_pacifist"
											ethic = "ethic_fanatic_egalitarian"
										}
									}
								}
								ethic_pacifist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_militarist"
											ethic = "ethic_fanatic_egalitarian"
										}
									}
								}
							}
						}
						ELSE_IF ={
							limit = { OR = {
								has_ethic = ethic_egalitarian
								has_ethic = ethic_fanatic_egalitarian
							} }
							switch = {
								trigger = has_ethic
								ethic_xenophobe = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no										
										authority = random
										ethos = {
											ethic = "ethic_xenophile"
											ethic = "ethic_fanatic_authoritarian"
										}
									}
								}
								ethic_xenophile = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_xenophobe"
											ethic = "ethic_fanatic_authoritarian"
										}
									}
								}
								ethic_materialist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_spiritualist"
											ethic = "ethic_fanatic_authoritarian"
										}
									}
								}
								ethic_spiritualist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_materialist"
											ethic = "ethic_fanatic_authoritarian"
										}
									}
								}
								ethic_militarist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_pacifist"
											ethic = "ethic_fanatic_authoritarian"
										}
									}
								}
								ethic_pacifist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_militarist"
											ethic = "ethic_fanatic_authoritarian"
										}
									}
								}
							}
						}
						ELSE_IF ={
							limit = { OR = {
								has_ethic = ethic_xenophobe
								has_ethic = ethic_fanatic_xenophobe 
							} }
							switch = {
								trigger = has_ethic
								ethic_materialist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_spiritualist"
											ethic = "ethic_fanatic_xenophile"
										}
									}
								}
								ethic_spiritualist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_materialist"
											ethic = "ethic_fanatic_xenophile"
										}
									}
								}
								ethic_militarist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_pacifist"
											ethic = "ethic_fanatic_xenophile"
										}
									}
								}
								ethic_pacifist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_militarist"
											ethic = "ethic_fanatic_xenophile"
										}
									}
								}
							}
						}
						ELSE_IF ={
							limit = { OR = {
								has_ethic = ethic_xenophile
								has_ethic = ethic_fanatic_xenophile
							} }
							switch = {
								trigger = has_ethic
								ethic_materialist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_spiritualist"
											ethic = "ethic_fanatic_xenophobe"
										}
										#Have to preset civics so we don't get fanatic purifiers...
										civics = {
											civic = civic_functional_architecture
											civic = civic_cutthroat_politics
										}
									}
								}
								ethic_spiritualist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_materialist"
											ethic = "ethic_fanatic_xenophobe"
										}
									}
								}
								ethic_militarist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_pacifist"
											ethic = "ethic_fanatic_xenophobe"
										}
									}
								}
								ethic_pacifist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_militarist"
											ethic = "ethic_fanatic_xenophobe"
										}
										#Have to preset civics so we don't get fanatic purifiers...
										civics = {
											civic = civic_functional_architecture
											civic = civic_cutthroat_politics
										}
									}
								}
							}
						}
						ELSE_IF ={
							limit = { OR = {
								has_ethic = ethic_materialist
								has_ethic = ethic_fanatic_materialist 
							} }
							switch = {
								trigger = has_ethic
								ethic_militarist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_pacifist"
											ethic = "ethic_fanatic_spiritualist"
										}
									}
								}
								ethic_pacifist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_militarist"
											ethic = "ethic_fanatic_spiritualist"
										}
									}
								}
							}
						}
						ELSE_IF ={
							limit = { OR = {
								has_ethic = ethic_spiritualist
								has_ethic = ethic_fanatic_spiritualist 
							} }
							switch = {
								trigger = has_ethic
								ethic_militarist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_pacifist"
											ethic = "ethic_fanatic_materialist"
										}
									}
								}
								ethic_pacifist = {
									create_country = {
										species = event_target:lrsk_sublight_overlord_species
										name_list = event_target:lrsk_sublight_overlord
										type = default
										origin = "lrsk_gov_var_origin_sublight_colony_dis"
										ignore_initial_colony_error = yes
										day_zero_contact = no
										authority = random
										ethos = {
											ethic = "ethic_militarist"
											ethic = "ethic_fanatic_materialist"
										}
									}
								}
							}
						}
						ELSE = {
							# fuck it, they get random if they somehow get this far...
							create_country = {
								species = event_target:lrsk_sublight_overlord_species
								name_list = event_target:lrsk_sublight_overlord
								type = default
								origin = "lrsk_gov_var_origin_sublight_colony_dis"
								ignore_initial_colony_error = yes
								day_zero_contact = no
								authority = random
								ethos = random
							}
						}
						log = "Finsihed total bullshit!!!!!!"
					}

					# COMMENT ALL THE FOLLOWING OUT IF NOT TESTING.
					#create_country = {
					#	species = event_target:lrsk_sublight_overlord_species
					#	name_list = event_target:lrsk_sublight_overlord
					#	type = default
					#	origin = "lrsk_gov_var_origin_sublight_colony_dis"
					#	ignore_initial_colony_error = yes
					#	day_zero_contact = no
					#	ethos = random # CHANGE THIS
					#}

					last_created_country = {
						save_event_target_as = lrsk_sublight_dissident_colony
						establish_communications_no_message = event_target:lrsk_sublight_overlord
						log = "Saved dissident country: [this.GetName]"
					}

					create_colony = {
						owner = event_target:lrsk_sublight_dissident_colony
					}
					generate_start_deposits_and_blockers = yes
					generate_start_buildings_and_districts = yes
					generate_start_pops = yes
					solar_system = {
						create_starbase = {
							size = starbase_starport
							module = shipyard
							building = crew_quarters
							owner = event_target:lrsk_sublight_dissident_colony
							effect = {
								set_starbase_module = {
									slot = 1
									module = trading_hub
								}
							}
						}
					}

					event_target:lrsk_sublight_dissident_colony = {
						create_starting_leaders = yes
						country_event = { id = game_start.9 }
						country_event = { id = game_start.33 days = 1 } # needs delay for system ownership to settle
						set_name = random # Fixes some naming issues
						log = "Establishing dissident country: [this.GetName]"

						add_modifier = { modifier = lrsk_gov_var_empire_colony_red_tape }
						IF = { limit = { event_target:lrsk_sublight_overlord = { has_origin = lrsk_gov_var_origin_sublight_empire } }
							add_modifier = { modifier = lrsk_gov_var_empire_black_box_drives }
							set_subject_of = {
								who = event_target:lrsk_sublight_overlord
								subject_type = lrsk_gov_var_sublight_vassal
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_ftlmn_sublight
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_vasag_sublight
							}
							log = "Detected this is sublight vassal of: [event_target:lrsk_sublight_overlord.GetName]"
						}
						ELSE = {
							set_subject_of = {
								who = event_target:lrsk_sublight_overlord
								subject_type = lrsk_gov_var_sublight_satellite
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_satag_sublight
							}
							log = "Detected this is sublight satellite of: [event_target:lrsk_sublight_overlord.GetName]"
						}
						add_opinion_modifier = {
							who = event_target:lrsk_sublight_overlord
							modifier = opinion_lrsk_gov_var_dsdnt_sublight
						}
						log = "Done with dissident establishment"
					}
				}
			}

			# Create genship
			closest_system = { limit = { any_system_planet = { has_planet_flag = lrsk_sublight_colony_planet } }
				log = "Creating genship system: [this.GetName]"
				random_system_planet = { limit = { has_planet_flag = lrsk_sublight_colony_planet }
					log = "Creating genship colony on: [this.GetName]"
					remove_planet_flag = lrsk_sublight_colony_planet
					set_planet_flag = lrsk_sublight_genship_homeworld
					create_country = {
						species = event_target:lrsk_sublight_overlord_species
						name_list = random
						type = default
						origin = "lrsk_gov_var_origin_sublight_colony_gsp"
						ignore_initial_colony_error = yes
						day_zero_contact = no
						authority = random
						ethos = random
						effect = {
							save_event_target_as = lrsk_sublight_genship_colony
							establish_communications_no_message = event_target:lrsk_sublight_overlord
						}
					}
					log = "Saved genship country: [event_target:lrsk_sublight_genship_colony.GetName]"

					create_colony = {
						owner = event_target:lrsk_sublight_genship_colony
					}
					generate_start_deposits_and_blockers = yes
					generate_start_buildings_and_districts = yes
					generate_start_pops = yes
					solar_system = {
						create_starbase = {
							size = starbase_starport
							module = shipyard
							building = crew_quarters
							owner = event_target:lrsk_sublight_genship_colony
							effect = {
								set_starbase_module = {
									slot = 1
									module = trading_hub
								}
							}
						}
					}

					event_target:lrsk_sublight_genship_colony = {
						create_starting_leaders = yes
						country_event = { id = game_start.9 }
						country_event = { id = game_start.33 days = 1 } # needs delay for system ownership to settle
						set_name = random # Fixes some naming issues
						log = "Establishing genship country: [this.GetName]"

						add_modifier = { modifier = lrsk_gov_var_empire_colony_red_tape }
						IF = { limit = { event_target:lrsk_sublight_overlord = { has_origin = lrsk_gov_var_origin_sublight_empire } }
							add_modifier = { modifier = lrsk_gov_var_empire_black_box_drives }
							set_subject_of = {
								who = event_target:lrsk_sublight_overlord
								subject_type = lrsk_gov_var_sublight_vassal
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_ftlmn_sublight
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_vasag_sublight
							}
							log = "Detected this is sublight vassal of: [event_target:lrsk_sublight_overlord.GetName]"
						}
						ELSE = {
							set_subject_of = {
								who = event_target:lrsk_sublight_overlord
								subject_type = lrsk_gov_var_sublight_satellite
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_satag_sublight
							}
							log = "Detected this is sublight satellite of: [event_target:lrsk_sublight_overlord.GetName]"
						}
						log = "Done with genship establishment"
					}
				}
			}

			# Create loyalists
			closest_system = { limit = { any_system_planet = { has_planet_flag = lrsk_sublight_colony_planet } }
				log = "Creating loyalist system: [this.GetName]"
				random_system_planet = { limit = { has_planet_flag = lrsk_sublight_colony_planet }
					log = "Creating loyalist colony on: [this.GetName]"
					remove_planet_flag = lrsk_sublight_colony_planet
					set_planet_flag = lrsk_sublight_loyalist_homeworld
					create_country = {
						species = event_target:lrsk_sublight_overlord_species
						name_list = event_target:lrsk_sublight_overlord
						type = default
						origin = "lrsk_gov_var_origin_sublight_colony_loy"
						ignore_initial_colony_error = yes
						day_zero_contact = no
						ethos = event_target:lrsk_sublight_overlord
						authority = event_target:lrsk_sublight_overlord
						effect = {
							save_event_target_as = lrsk_sublight_loyalist_colony
							establish_communications_no_message = event_target:lrsk_sublight_overlord
						}
					}
					log = "Saved loyalist country: [event_target:lrsk_sublight_genship_colony.GetName]"

					create_colony = {
						owner = event_target:lrsk_sublight_loyalist_colony
					}
					generate_start_deposits_and_blockers = yes
					generate_start_buildings_and_districts = yes
					generate_start_pops = yes
					solar_system = {
						create_starbase = {
							size = starbase_starport
							module = shipyard
							building = crew_quarters
							owner = event_target:lrsk_sublight_loyalist_colony
							effect = {
								set_starbase_module = {
									slot = 1
									module = trading_hub
								}
							}
						}
					}

					event_target:lrsk_sublight_loyalist_colony = {
						create_starting_leaders = yes
						country_event = { id = game_start.9 }
						country_event = { id = game_start.33 days = 1 } # needs delay for system ownership to settle
						set_name = random # Fixes some naming issues
						log = "Establishing loyalist country: [this.GetName]"

						add_modifier = { modifier = lrsk_gov_var_empire_colony_red_tape }
						IF = { limit = { event_target:lrsk_sublight_overlord = { has_origin = lrsk_gov_var_origin_sublight_empire } }
							add_modifier = { modifier = lrsk_gov_var_empire_black_box_drives }
							set_subject_of = {
								who = event_target:lrsk_sublight_overlord
								subject_type = lrsk_gov_var_sublight_vassal
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_ftlmn_sublight
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_vasag_sublight
							}
							log = "Detected this is sublight vassal of: [event_target:lrsk_sublight_overlord.GetName]"
						}
						ELSE = {
							set_subject_of = {
								who = event_target:lrsk_sublight_overlord
								subject_type = lrsk_gov_var_sublight_satellite
							}
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord
								modifier = opinion_lrsk_gov_var_satag_sublight
							}
							log = "Detected this is sublight satellite of: [event_target:lrsk_sublight_overlord.GetName]"
						}
						add_opinion_modifier = {
							who = event_target:lrsk_sublight_overlord
							modifier = opinion_lrsk_gov_var_loyal_sublight
						}
						log = "Done with loyalist establishment"
					}
				}			
			}

			# I want to create one more hyperlane out of the home system just in case all direct neighbor systems are taken.
			# This won't guarantee a route out without going through a vassal, but...
			closest_system = {
				limit = {
					has_owner = no
					NOT = { has_hyperlane_to = prev }
				}
				log = "hyperlane thing"
				add_hyperlane = { from = this to = prev }
			}
		} }

		# Set overlord opinions
		IF = { limit = { has_origin = lrsk_gov_var_origin_sublight_empire }
			log = "Adding sublight empire overlord opinion of vassals for [this.GetName]"
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_dissident_colony
				modifier = opinion_lrsk_gov_var_vasol_sublight
			}
			log = "Dissidents: Done."
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_genship_colony
				modifier = opinion_lrsk_gov_var_vasol_sublight
			}
			log = "GenShip: Done."
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_loyalist_colony
				modifier = opinion_lrsk_gov_var_vasol_sublight
			}
			log = "Loyalists: Done."
		}
		ELSE = {
			log = "Adding sublight commonwealth overlord opinion of satellites for [this.GetName]"
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_dissident_colony
				modifier = opinion_lrsk_gov_var_satol_sublight
			}
			log = "Dissidents: Done."
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_genship_colony
				modifier = opinion_lrsk_gov_var_satol_sublight
			}
			log = "GenShip: Done."
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_loyalist_colony
				modifier = opinion_lrsk_gov_var_satol_sublight
			}
			log = "Loyalists: Done."
		}

		# FTL monopoly break
		if = { limit = { has_origin = lrsk_gov_var_origin_sublight_empire }
			event_target:lrsk_sublight_dissident_colony = {
				country_event = {
					id = lrsk_gov_var_sublight_origins.2
					days = 3600
					random = 1800
					# Between 5 and 15 years from start.
				}
			}
			event_target:lrsk_sublight_genship_colony = {
				country_event = {
					id = lrsk_gov_var_sublight_origins.2
					days = 5400
					random = 2520
					# Between 8 and 22 years from start.
				}
			}
			event_target:lrsk_sublight_loyalist_colony = {
				country_event = {
					id = lrsk_gov_var_sublight_origins.2
					days = 7200
					random = 3240
					# Between 11 and 29 years from start.
				}
			}
		}
	}
}

# FTL monopoly break
country_event = {
	id = lrsk_gov_var_sublight_origins.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_subject_type = lrsk_gov_var_sublight_vassal
		has_modifier = lrsk_gov_var_empire_black_box_drives
	}

	immediate = {
		IF = {
			limit = {
				is_subject_type = lrsk_gov_var_sublight_vassal
				has_modifier = lrsk_gov_var_empire_black_box_drives	
			}
			
			# Haggle over it or take right away
			random_list = {
				40 = {
					modifier = {
						add = -20
						has_origin = lrsk_gov_var_origin_sublight_colony_dis
					}
					modifier = {
						add = 20
						has_origin = lrsk_gov_var_origin_sublight_colony_loy
					}
					modifier = {
						add = 10
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= excellent
						}
					}
					modifier = {
						add = 10
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= good
						}
					}
					modifier = {
						add = -5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= poor
						}
					}
					modifier = {
						add = -5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= terrible
						}
					}
					modifier = {
						factor = 0
						NOT = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
						has_modifier = lrsk_gov_var_empire_colony_favors
					}
					# Haggle for lifting of red tape
					event_target:lrsk_sublight_overlord = { country_event = { id = lrsk_gov_var_sublight_origins.5 days = 30 } }
				}
				60 = {
					modifier = {
						add = 20
						has_origin = lrsk_gov_var_origin_sublight_colony_dis
					}
					modifier = {
						add = -20
						has_origin = lrsk_gov_var_origin_sublight_colony_loy
					}
					modifier = {
						add = -10
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= excellent
						}
					}
					modifier = {
						add = -10
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= good
						}
					}
					modifier = {
						add = 5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= poor
						}
					}
					modifier = {
						add = 5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= terrible
						}
					}
					# Get FTL
					country_event = { id = lrsk_gov_var_sublight_origins.22 days = 1 }
				}
			}
			# Spread to others
			random_list = {
				# Don't tell
				50 = {
					modifier = {
						factor = 0.5
						has_origin = lrsk_gov_var_origin_sublight_colony_dis
					}
					modifier = {
						factor = 1.5
						has_origin = lrsk_gov_var_origin_sublight_colony_loy
					}
					modifier = {
						add = 10
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= excellent
						}
					}
					modifier = {
						add = 5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= good
						}
					}
					modifier = {
						add = -10
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= poor
						}
					}
					modifier = {
						add = -5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= terrible
						}
					}
					# Do Nothing
				}
				# Tell
				50 = {
					modifier = {
						factor = 1.5
						has_origin = lrsk_gov_var_origin_sublight_colony_dis
					}
					modifier = {
						factor = 0.5
						has_origin = lrsk_gov_var_origin_sublight_colony_loy
					}
					modifier = {
						add = -5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= excellent
						}
					}
					modifier = {
						add = -10
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= good
						}
					}
					modifier = {
						add = 10
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= poor
						}
					}
					modifier = {
						add = 5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= terrible
						}
					}
					switch = {
						trigger = has_origin
						lrsk_gov_var_origin_sublight_colony_loy = {
							event_target:lrsk_sublight_dissident_colony = { country_event = { id = lrsk_gov_var_sublight_origins.3 days = 30 } }
							event_target:lrsk_sublight_genship_colony = { country_event = { id = lrsk_gov_var_sublight_origins.3 days = 30 } }
						}
						lrsk_gov_var_origin_sublight_colony_gsp = {
							event_target:lrsk_sublight_dissident_colony = { country_event = { id = lrsk_gov_var_sublight_origins.3 days = 30 } }
							event_target:lrsk_sublight_loyalist_colony = { country_event = { id = lrsk_gov_var_sublight_origins.3 days = 30 } }
						}
						lrsk_gov_var_origin_sublight_colony_dis = {
							event_target:lrsk_sublight_genship_colony = { country_event = { id = lrsk_gov_var_sublight_origins.3 days = 30 } }
							event_target:lrsk_sublight_loyalist_colony = { country_event = { id = lrsk_gov_var_sublight_origins.3 days = 30 } }
						}
					}
				}
			}
		}
	}
}


# Try getting FTL again (not sure I can recursively call events...
country_event = {
	id = lrsk_gov_var_sublight_origins.21
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_subject_type = lrsk_gov_var_sublight_vassal
		has_modifier = lrsk_gov_var_empire_black_box_drives
	}

	immediate = {
		IF = {
			limit = {
				is_subject_type = lrsk_gov_var_sublight_vassal
				has_modifier = lrsk_gov_var_empire_black_box_drives	
			}
			country_event = { id = lrsk_gov_var_sublight_origins.2 days = 1 }
		}
	}			

}


# Common logic for gaining FTL
country_event = {
	id = lrsk_gov_var_sublight_origins.22
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_subject_type = lrsk_gov_var_sublight_vassal
		has_modifier = lrsk_gov_var_empire_black_box_drives
	}

	immediate = {
		IF = {
			limit = {
				is_subject_type = lrsk_gov_var_sublight_vassal
				has_modifier = lrsk_gov_var_empire_black_box_drives	
			}
			# Get FTL, no longer beholden
			remove_modifier = lrsk_gov_var_empire_black_box_drives
			remove_opinion_modifier = {
				who = event_target:lrsk_sublight_overlord
				modifier = opinion_lrsk_gov_var_ftlmn_sublight
			}
			IF = { limit = { NOT = { has_origin = lrsk_gov_var_origin_sublight_colony_loy } }
				IF = { limit = { has_modifier = lrsk_gov_var_empire_colony_red_tape }	# If you've benefitted them in the past, no penalty now that free
					add_opinion_modifier = {
						who = event_target:lrsk_sublight_overlord
						modifier = opinion_lrsk_gov_var_thrall_sublight
					}
				}
				IF = { limit = { has_origin = lrsk_gov_var_origin_sublight_colony_dis }	# Some folks you just can't win with
					add_opinion_modifier = {
						who = event_target:lrsk_sublight_overlord
						modifier = opinion_lrsk_gov_var_ffree_sublight
					}
				}
			}
			set_country_flag = lrsk_sublight_colony_got_FTL

			# Informs overlord
			IF = { limit = { NOT = { has_country_flag = lrsk_sublight_overlord_refused_to_haggle } }
				event_target:lrsk_sublight_overlord = { country_event = { id = lrsk_gov_var_sublight_origins.4 days = 1 } }
			}
		}
	}			

}

# Get FTL from other colony
country_event = {
	id = lrsk_gov_var_sublight_origins.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_subject_type = lrsk_gov_var_sublight_vassal
		has_modifier = lrsk_gov_var_empire_black_box_drives		
	}

	immediate = {
		IF = {
			limit = {
				is_subject_type = lrsk_gov_var_sublight_vassal
				has_modifier = lrsk_gov_var_empire_black_box_drives		
			}
			add_opinion_modifier = { 
				who = from
				modifier = opinion_lrsk_gov_var_ftlgift_sublight
			}
			random_list = {
				40 = {
					modifier = {
						factor = 0.25
						has_origin = lrsk_gov_var_origin_sublight_colony_dis
					}
					modifier = {
						factor = 1.75
						has_origin = lrsk_gov_var_origin_sublight_colony_loy
					}
					modifier = {
						add = 5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= excellent
						}
					}
					modifier = {
						add = 5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level >= good
						}
					}
					modifier = {
						factor = 0
						NOT = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
						has_modifier = lrsk_gov_var_empire_colony_favors
					}

					# Haggle for lifting of red tape
					event_target:lrsk_sublight_overlord = { country_event = { id = lrsk_gov_var_sublight_origins.5 days = 30 } }
				}
				60 = {
					modifier = {
						factor = 1.5
						has_origin = lrsk_gov_var_origin_sublight_colony_dis
					}
					modifier = {
						factor = 0.5
						has_origin = lrsk_gov_var_origin_sublight_colony_loy
					}
					modifier = {
						add = 5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= poor
						}
					}
					modifier = {
						add = 5
						opinion_level = {
							who = event_target:lrsk_sublight_overlord
							level <= terrible
						}
					}
					# Take it
					set_country_flag = lrsk_sublight_colony_took_gifted_FTL
					country_event = { id = lrsk_gov_var_sublight_origins.22 days = 1 }
				}
			}
		}
	}
}

# Notify overlord of FTL
country_event = {
	id = lrsk_gov_var_sublight_origins.4
	title = lrsk_gov_var_sublight_origins.4.name
	#desc = 
	picture = GFX_evt_ship_travel
	#show_sound = event_laboratory_sound
	desc = {
		trigger = {
			from = { NOT = { has_country_flag = lrsk_sublight_colony_took_gifted_FTL } }
		}
		text = lrsk_gov_var_sublight_origins.4.desc.a
	}
	desc = {
		trigger = {
			from = { has_country_flag = lrsk_sublight_colony_took_gifted_FTL }
		}
		text = lrsk_gov_var_sublight_origins.4.desc.b
	}

	is_triggered_only = yes

	trigger = { from = {
		# I hope this prevents this from firing in the event that the sender is independent somehow
		is_subject_type = lrsk_gov_var_sublight_vassal
		has_modifier = lrsk_gov_var_empire_black_box_drives	
	} }

	option = {
		name = lrsk_gov_var_sublight_origins.4.a
		custom_tooltip = lrsk_gov_var_sublight_origins.4.a.tooltip

		add_resource = { influence = -25 }
	}

	option = {
		name = lrsk_gov_var_sublight_origins.4.b
		custom_tooltip = lrsk_gov_var_sublight_origins.4.a.tooltip

		# We haven't done them any favors yet and therefore we are not big mad
		trigger = { from = { OR = {
			has_modifier = lrsk_gov_var_empire_colony_red_tape
			NOT = { has_modifier = lrsk_gov_var_empire_colony_favors }
		} } }

		add_resource = { influence = 100 }

		hidden_effect = {
			# We're not pleased!
			add_opinion_modifier = {
				who = from
				modifier = opinion_lrsk_gov_var_oldire_sublight
			}

			from =  {
				add_modifier = { modifier = lrsk_gov_var_empire_colony_penalty }
				add_opinion_modifier = {
					who = event_target:lrsk_sublight_overlord
					modifier = opinion_lrsk_gov_var_stick_sublight
				}
			}
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.4.c
		custom_tooltip = lrsk_gov_var_sublight_origins.4.c.tooltip

		# We haven't done them any favors yet and therefore we are not big mad
		trigger = { from = { OR = {
			has_modifier = lrsk_gov_var_empire_colony_red_tape
			NOT = { has_modifier = lrsk_gov_var_empire_colony_favors }
		} } }

		hidden_effect = {
			#Remove any prior favoritism flag
			every_subject = { limit = { has_country_flag = lrsk_sublight_colony_overlord_favored }
				remove_country_flag = lrsk_sublight_colony_overlord_favored
			}
			from =  {
				add_modifier = { modifier = lrsk_gov_var_empire_colony_favors }
				add_opinion_modifier = {
					who = event_target:lrsk_sublight_overlord
					modifier = opinion_lrsk_gov_var_carrot_sublight
				}
				set_country_flag = lrsk_sublight_colony_overlord_favored
				save_event_target_as = lrsk_sublight_favored_one
			}
			every_subject = {
				# Playing favorites
				country_event = { id = lrsk_gov_var_sublight_origins.44 }
			}
			country_event = { id = lrsk_gov_var_sublight_origins.200 }
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.4.d
		custom_tooltip = lrsk_gov_var_sublight_origins.4.d.tooltip

		# We BIG MAD
		trigger = { from = { OR = {
			NOT = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
			has_modifier = lrsk_gov_var_empire_colony_favors
		} } }

		add_resource = { influence = 250 }

		hidden_effect = {
			# This one's just on principle
			add_opinion_modifier = {
				who = from
				modifier = opinion_lrsk_gov_var_oldire_sublight
			}

			from = {
				save_event_target_as = lrsk_sublight_whipping_boy

				# Red tape is back if applicable
				IF = { limit = {  NOR = { 
						has_modifier = lrsk_gov_var_empire_colony_red_tape
						event_target:lrsk_sublight_overlord = { has_country_flag = lrsk_sublight_overlord_abolished_redtape }
					} }
					add_modifier = { modifier = lrsk_gov_var_empire_colony_red_tape }
					
					# Make them hate us
					add_opinion_modifier = {
						who = event_target:lrsk_sublight_overlord
						modifier = opinion_lrsk_gov_var_stick_sublight
					}
					# We hate them too
					event_target:lrsk_sublight_overlord = { add_opinion_modifier = {
						who = event_target:lrsk_sublight_whipping_boy
						modifier = opinion_lrsk_gov_var_oldire_sublight
					} }
				}
				# No more favors
				IF = { limit = { has_modifier = lrsk_gov_var_empire_colony_favors }
					remove_modifier = lrsk_gov_var_empire_colony_favors
					
					# Make them hate us
					add_opinion_modifier = {
						who = event_target:lrsk_sublight_overlord
						modifier = opinion_lrsk_gov_var_stick_sublight
					}
					# We hate them too
					event_target:lrsk_sublight_overlord = { add_opinion_modifier = {
						who = event_target:lrsk_sublight_whipping_boy
						modifier = opinion_lrsk_gov_var_oldire_sublight
					} }
				}
				# Get dunked on
				IF = { limit = { NOT = { has_modifier = lrsk_gov_var_empire_colony_penalty } }
					add_modifier = { modifier = lrsk_gov_var_empire_colony_penalty }
					
					# Make them hate us
					add_opinion_modifier = {
						who = event_target:lrsk_sublight_overlord
						modifier = opinion_lrsk_gov_var_stick_sublight
					}
					# We hate them too
					event_target:lrsk_sublight_overlord = { add_opinion_modifier = {
						who = event_target:lrsk_sublight_whipping_boy
						modifier = opinion_lrsk_gov_var_oldire_sublight
					} }
				}
			}
		}
	}
}

# Playing favorites
country_event = {
	id = lrsk_gov_var_sublight_origins.44
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		IF = { limit = { NOT = { has_country_flag = lrsk_sublight_colony_overlord_favored } }
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_overlord
				modifier = opinion_lrsk_gov_var_favors_sublight
			}
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_favored_one
				modifier = opinion_lrsk_gov_var_stooge_sublight
			}
		}
	}
}

# Subject leadership
country_event = {
	id = lrsk_gov_var_sublight_origins.45
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		IF = { limit = { NOT = { has_country_flag = lrsk_sublight_colony_helped_all } }
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_overlord
				modifier = opinion_lrsk_gov_var_benev_sublight
			}
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_benefactor
				modifier = opinion_lrsk_gov_var_leader_sublight
			}
		}
	}
}

# Haggle over FTL
country_event = {
	id = lrsk_gov_var_sublight_origins.5
	title = lrsk_gov_var_sublight_origins.5.name
	desc = lrsk_gov_var_sublight_origins.5.desc
	picture = GFX_evt_partition
	#show_sound = event_laboratory_sound

	is_triggered_only = yes

	trigger = { from = {
		# I hope this prevents this from firing in the event that the sender is independent somehow
		is_subject_type = lrsk_gov_var_sublight_vassal
		has_modifier = lrsk_gov_var_empire_black_box_drives	
	} }

	option = {
		name = lrsk_gov_var_sublight_origins.5.a
		custom_tooltip = lrsk_gov_var_sublight_origins.5.a.tooltip

		add_resource = { influence = 100 }

		hidden_effect = {
			# We're not pleased!
			add_opinion_modifier = {
				who = from
				modifier = opinion_lrsk_gov_var_oldire_sublight
			}
			from =  {
				set_country_flag = lrsk_sublight_overlord_refused_to_haggle
				add_opinion_modifier = {
					who = event_target:lrsk_sublight_overlord
					modifier = opinion_lrsk_gov_var_stick_sublight
				}
				country_event = { id = lrsk_gov_var_sublight_origins.22 days = 1 }
			}
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.5.b
		custom_tooltip = lrsk_gov_var_sublight_origins.5.a.tooltip

		trigger = {
			from = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
		}

		hidden_effect = { from =  {
			remove_modifier = lrsk_gov_var_empire_colony_red_tape
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_overlord
				modifier = opinion_lrsk_gov_var_carrot_sublight
			}
			IF = { limit = { has_modifier = lrsk_gov_var_empire_black_box_drives }
				# They will keep trying, this will come up again... 
				country_event = {
					id = lrsk_gov_var_sublight_origins.21
					days = 3600
					random = 1800
					# Between 5 and 10 years later.						
				}
			}
		} }
	}

	option = {
		name = lrsk_gov_var_sublight_origins.5.c
		custom_tooltip = lrsk_gov_var_sublight_origins.5.c.tooltip

		trigger = {
			from = { NOT = { has_modifier = lrsk_gov_var_empire_colony_red_tape } }
		}

		hidden_effect = { from =  {
			add_modifier = { modifier = lrsk_gov_var_empire_colony_favors }
			add_opinion_modifier = {
				who = event_target:lrsk_sublight_overlord
				modifier = opinion_lrsk_gov_var_carrot_sublight
			}
			IF = { limit = { has_modifier = lrsk_gov_var_empire_black_box_drives }
				# They will keep trying, this will come up again... 
				country_event = {
					id = lrsk_gov_var_sublight_origins.21
					days = 3600
					random = 1800
					# Between 5 and 10 years later.						
				}
			}
		} }
	}
}

# Periodic whining gatekeeper
country_event = {
	id = lrsk_gov_var_sublight_origins.61
	hide_window = yes
	mean_time_to_happen = { years = 5 }

	trigger = {
		event_target:lrsk_sublight_overlord = { NOT = { has_country_flag = lrsk_sublight_whining_cooldown } }
		OR = {
			is_subject_type = lrsk_gov_var_sublight_vassal
			is_subject_type = lrsk_gov_var_sublight_satellite
		}
		OR = { 
			has_modifier = lrsk_gov_var_empire_colony_red_tape
			NOT = { has_modifier = lrsk_gov_var_empire_colony_favors }
		}		
	}

	immediate = {
		event_target:lrsk_sublight_overlord = { country_event = { id = lrsk_gov_var_sublight_origins.6 } }
	}
}

# Periodic whining event
country_event = {
	id = lrsk_gov_var_sublight_origins.6
	title = lrsk_gov_var_sublight_origins.6.name
	desc = lrsk_gov_var_sublight_origins.6.desc
	picture = GFX_evt_arguing_senate
	#show_sound = event_laboratory_sound

	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = lrsk_sublight_whining_cooldown }
		from = {
			OR = {
				is_subject_type = lrsk_gov_var_sublight_vassal
				is_subject_type = lrsk_gov_var_sublight_satellite
			}
			OR = { 
				has_modifier = lrsk_gov_var_empire_colony_red_tape
				NOT = { has_modifier = lrsk_gov_var_empire_colony_favors }
			}
		}
	}

	immediate = {
		set_timed_country_flag = {
			flag = lrsk_sublight_whining_cooldown
			days = 720 # 2 year cooldown
		}
		from = { save_event_target_as = lrsk_sublight_petitioner }
		IF = { 
			limit = { any_subject = { 
				NOT = { is_same_value = event_target:lrsk_sublight_petitioner }
				has_modifier = lrsk_gov_var_empire_colony_red_tape
			} }
			set_country_flag = lrsk_sublight_other_red_tape_beneficiaries
		}
		IF = { 
			limit = { any_subject = {
				OR = {
					is_subject_type = lrsk_gov_var_sublight_vassal
					is_subject_type = lrsk_gov_var_sublight_satellite
				}
				NOR = { 
					is_same_value = event_target:lrsk_sublight_petitioner
					has_modifier = lrsk_gov_var_empire_colony_favors
				}
			} }
			set_country_flag = lrsk_sublight_other_trade_beneficiaries
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.6.a
		custom_tooltip = lrsk_gov_var_sublight_origins.6.a.tooltip

		trigger = {
			from = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
		}

		hidden_effect = {
			set_country_flag = lrsk_sublight_overlord_abolished_redtape
			#Remove any prior leadership flag
			every_subject = { limit = { has_country_flag = lrsk_sublight_colony_helped_all }
				remove_country_flag = lrsk_sublight_colony_helped_all
			}
			# Subject Leadership
			event_target:lrsk_sublight_petitioner = { 
				save_event_target_as = lrsk_sublight_benefactor
				set_country_flag = lrsk_sublight_colony_helped_all
			}
			every_subject = {
				IF = { limit = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
					remove_modifier = lrsk_gov_var_empire_colony_red_tape
					set_country_flag = lrsk_sublight_overloard_cut_our_red_tape
				}
				country_event = { id = lrsk_gov_var_sublight_origins.45 }
			}
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.6.b
		custom_tooltip = lrsk_gov_var_sublight_origins.6.b.tooltip

		trigger = {
			from = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
			has_country_flag = lrsk_sublight_other_red_tape_beneficiaries
		}

		hidden_effect = {
			#Remove any prior favoritism flag
			every_subject = { limit = { has_country_flag = lrsk_sublight_colony_overlord_favored }
				remove_country_flag = lrsk_sublight_colony_overlord_favored
			}
			from =  {
				remove_modifier = lrsk_gov_var_empire_colony_red_tape
				set_country_flag = lrsk_sublight_overloard_cut_our_red_tape
				add_opinion_modifier = {
					who = event_target:lrsk_sublight_overlord
					modifier = opinion_lrsk_gov_var_carrot_sublight
				}
				set_country_flag = lrsk_sublight_colony_overlord_favored
				save_event_target_as = lrsk_sublight_favored_one
			}
			every_subject = {
				# Playing favorites
				country_event = { id = lrsk_gov_var_sublight_origins.44 }
			}
			country_event = { id = lrsk_gov_var_sublight_origins.200 }
		}	
	}

	option = {
		name = lrsk_gov_var_sublight_origins.6.c
		custom_tooltip = lrsk_gov_var_sublight_origins.6.c.tooltip

		trigger = {
			from = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
		}

		add_resource = { influence = 100 }

		hidden_effect = {
			every_subject = {
				limit = { OR = {
					is_subject_type = lrsk_gov_var_sublight_vassal
					is_subject_type = lrsk_gov_var_sublight_satellite
				} }
				add_opinion_modifier = {
					who = root
					modifier = opinion_lrsk_gov_var_stick_sublight
				}
			}
		}	
	}

	option = {
		name = lrsk_gov_var_sublight_origins.6.d
		custom_tooltip = lrsk_gov_var_sublight_origins.6.d.tooltip

		trigger = {
			from = { NOR = {
				has_modifier = lrsk_gov_var_empire_colony_favors
				has_modifier = lrsk_gov_var_empire_colony_red_tape
			} }
		}

		hidden_effect = {
			#Remove any prior leadership flag
			every_subject = { limit = { has_country_flag = lrsk_sublight_colony_helped_all }
				remove_country_flag = lrsk_sublight_colony_helped_all
			}
			# Subject Leadership
			event_target:lrsk_sublight_petitioner = { 
				save_event_target_as = lrsk_sublight_benefactor
				set_country_flag = lrsk_sublight_colony_helped_all
			}
			every_subject = {
				IF = { 
					limit = {
						NOT = { has_modifier = lrsk_gov_var_empire_colony_favors }
						OR = {
							is_subject_type = lrsk_gov_var_sublight_vassal
							is_subject_type = lrsk_gov_var_sublight_satellite
						}
					}
					add_modifier = { modifier = lrsk_gov_var_empire_colony_favors }
				}
				country_event = { id = lrsk_gov_var_sublight_origins.45 }
			}
		}
	
	}

	option = {
		name = lrsk_gov_var_sublight_origins.6.e
		custom_tooltip = lrsk_gov_var_sublight_origins.6.e.tooltip

		trigger = {
			from = { NOR = {
				has_modifier = lrsk_gov_var_empire_colony_favors
				has_modifier = lrsk_gov_var_empire_colony_red_tape
			} }
			has_country_flag = lrsk_sublight_other_trade_beneficiaries
		}

		hidden_effect = {
			#Remove any prior favoritism flag
			every_subject = { limit = { has_country_flag = lrsk_sublight_colony_overlord_favored }
				remove_country_flag = lrsk_sublight_colony_overlord_favored
			}
			from =  {
				add_modifier = { modifier = lrsk_gov_var_empire_colony_favors }
				add_opinion_modifier = {
					who = event_target:lrsk_sublight_overlord
					modifier = opinion_lrsk_gov_var_carrot_sublight
				}
				set_country_flag = lrsk_sublight_colony_overlord_favored
				save_event_target_as = lrsk_sublight_favored_one
			}
			every_subject = {
				# Playing favorites
				country_event = { id = lrsk_gov_var_sublight_origins.44 }
			}
			country_event = { id = lrsk_gov_var_sublight_origins.200 }
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.6.f
		custom_tooltip = lrsk_gov_var_sublight_origins.6.f.tooltip

		trigger = {
			from = { NOR = {
				has_modifier = lrsk_gov_var_empire_colony_favors
				has_modifier = lrsk_gov_var_empire_colony_red_tape
			} }
		}

		add_resource = { influence = 100 }

		hidden_effect = {
			every_subject = {
				limit = { OR = {
					is_subject_type = lrsk_gov_var_sublight_vassal
					is_subject_type = lrsk_gov_var_sublight_satellite
				} }
				add_opinion_modifier = {
					who = root
					modifier = opinion_lrsk_gov_var_stick_sublight
				}
			}
		}	
	}

	option = {
		name = lrsk_gov_var_sublight_origins.6.g
		custom_tooltip = lrsk_gov_var_sublight_origins.6.g.tooltip

		allow = {
			has_resource = {
				amount > 499
				type = energy
			}
		}

		trigger = {
			NOT = { has_country_flag = lrsk_sublight_media_campaign_cooldown }
			from = { OR = {
				NOT = { has_modifier = lrsk_gov_var_empire_colony_favors }
				has_modifier = lrsk_gov_var_empire_colony_red_tape
			} }
		}

		add_resource = { energy = -500 }

		hidden_effect = {
			country_event = { id = lrsk_gov_var_sublight_origins.200 }
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.6.h
		custom_tooltip = lrsk_gov_var_sublight_origins.6.h.tooltip

		allow = {
			has_resource = {
				amount > 49
				type = influence
			}
		}

		trigger = {
			from = { OR = {
				NOT = { has_modifier = lrsk_gov_var_empire_colony_favors }
				has_modifier = lrsk_gov_var_empire_colony_red_tape
			} }
		}

		add_resource = { influence = -50 }
		
		hidden_effect = {
			set_timed_country_flag = {
				flag = lrsk_sublight_media_campaign_cooldown
				days = 3600
			}
			every_subject = {
				add_opinion_modifier = {
					who = event_target:lrsk_sublight_overlord
					modifier = opinion_lrsk_gov_var_benev_sublight
				}
			}
		}
	}
}

# Colonial Reform Start
country_event = {
	id = lrsk_gov_var_sublight_origins.7
	title = lrsk_gov_var_sublight_origins.7.name
	desc = lrsk_gov_var_sublight_origins.7.desc
	picture = GFX_evt_board_meeting

	mean_time_to_happen = { years = 100 }

	# This will only happen if you actually have sublight vassals/satellites with no FTl restrictions
	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
		any_subject = {
			OR = {
				is_subject_type = lrsk_gov_var_sublight_vassal
				is_subject_type = lrsk_gov_var_sublight_satellite
			}
		}
		NOT = { any_subject = {
			has_modifier = lrsk_gov_var_empire_black_box_drives
		} }	
	}

	option = {
		name = lrsk_gov_var_sublight_origins.7.a
		custom_tooltip = lrsk_gov_var_sublight_origins.7.a.tooltip

		hidden_effect = {
			enable_special_project = {
				name = "LRSK_GOV_VAR_COLONIAL_RESTRUCTURING"
				location = this.capital_scope
				owner = this
			}
		}
	}
}

# Colonial Reform Start/Gate
country_event = {
	id = lrsk_gov_var_sublight_origins.80
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
	}

	immediate = {
		IF = {
			limit = { any_subject = {  OR = {
				is_subject_type = lrsk_gov_var_sublight_vassal
				is_subject_type = lrsk_gov_var_sublight_satellite
			} } }
			country_event = { id = lrsk_gov_var_sublight_origins.8 }	# We're good to go in this case
		}
		ELSE_IF = { limit = { has_country_flag = lrsk_sublight_reform_in_place }
			country_event = {
				id = lrsk_gov_var_sublight_origins.80					# Tried before, will have to try again
				days = 1800
			}
		}
		ELSE = {
			country_event = { id = lrsk_gov_var_sublight_origins.81 }	# Notify that we have to try again
		}
	}
}

# Colonial Reform Decision
country_event = {
	id = lrsk_gov_var_sublight_origins.8
	title = lrsk_gov_var_sublight_origins.8.name
	desc = lrsk_gov_var_sublight_origins.8.desc
	picture = GFX_evt_partition
	
	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.8.a.empire
		custom_tooltip = lrsk_gov_var_sublight_origins.8.a.empire.tooltip

		trigger = { has_origin = lrsk_gov_var_origin_sublight_empire }

		hidden_effect = {
			set_country_flag = lrsk_sublight_overloard_colonial_system_reformed
			every_subject = {
				limit = { is_subject_type = lrsk_gov_var_sublight_vassal }
				set_country_flag = lrsk_sublight_colony_offered_federation
			}
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.8.b.empire
		custom_tooltip = lrsk_gov_var_sublight_origins.8.b.empire.tooltip

		trigger = { has_origin = lrsk_gov_var_origin_sublight_empire }
		
		hidden_effect = {
			set_country_flag = lrsk_sublight_overloard_colonial_system_reformed
			every_subject = {
				limit = { is_subject_type = lrsk_gov_var_sublight_vassal }
				set_country_flag = lrsk_sublight_colony_offered_vassalization
			}
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.8.a.commonwealth
		custom_tooltip = lrsk_gov_var_sublight_origins.8.a.commonwealth.tooltip

		trigger = { has_origin = lrsk_gov_var_origin_sublight_commonwealth }
		
		hidden_effect = {
			set_country_flag = lrsk_sublight_overloard_colonial_system_reformed
			every_subject = {
				limit = { is_subject_type = lrsk_gov_var_sublight_satellite }
				set_country_flag = lrsk_sublight_colony_offered_federation
			}
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.8.b.commonwealth
		custom_tooltip = lrsk_gov_var_sublight_origins.8.b.commonwealth.tooltip

		trigger = { has_origin = lrsk_gov_var_origin_sublight_commonwealth }
		
		hidden_effect = {
			set_country_flag = lrsk_sublight_overloard_colonial_system_reformed
			every_subject = {
				limit = { is_subject_type = lrsk_gov_var_sublight_satellite }
				set_country_flag = lrsk_sublight_colony_offered_vassalization
			}
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.8.c
		custom_tooltip = lrsk_gov_var_sublight_origins.8.c.tooltip

		hidden_effect = {
			country_event = {
				id = lrsk_gov_var_sublight_origins.80
				days = 3600
			}
		}
	}

	after = {		
		# One way or another, none of this is relevant anymore
		IF = { limit = { has_modifier = lrsk_gov_var_empire_colony_opentrade }
			remove_modifier = lrsk_gov_var_empire_colony_opentrade
		}
	}
}

# Colonial Reform Holding Pattern
country_event = {
	id = lrsk_gov_var_sublight_origins.81
	title = lrsk_gov_var_sublight_origins.81.name
	desc = lrsk_gov_var_sublight_origins.81.desc
	picture = GFX_evt_board_meeting
	
	is_triggered_only = yes

	option = {
		name = lrsk_gov_var_sublight_origins.81.a
		custom_tooltip = lrsk_gov_var_sublight_origins.81.a.tooltip

		hidden_effect = {
			set_country_flag = lrsk_sublight_reform_in_place
			country_event = {
				id = lrsk_gov_var_sublight_origins.80
				days = 1800
			}
		}
	}
}

# Colony offer gate
# Want a dely in notification with instant execution...
country_event = {
	id = lrsk_gov_var_sublight_origins.833
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
	}

	immediate = {
		every_subject = {
			limit = { OR = {
				is_subject_type = lrsk_gov_var_sublight_vassal
				is_subject_type = lrsk_gov_var_sublight_satellite
			} }
			country_event = {
				id = lrsk_gov_var_sublight_origins.83
				days = 7
				random = 3
			}
		}
	}
}

# Colony gets offer
country_event = {
	id = lrsk_gov_var_sublight_origins.83
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		OR = {
			is_subject_type = lrsk_gov_var_sublight_vassal
			is_subject_type = lrsk_gov_var_sublight_satellite
		}
	}

	immediate = {
		# One way or another, none of this is relevant anymore
		IF = { limit = { has_modifier = lrsk_gov_var_empire_colony_red_tape }
			remove_modifier = lrsk_gov_var_empire_colony_red_tape
		}
		IF = { limit = { has_modifier = lrsk_gov_var_empire_colony_penalty }
			remove_modifier = lrsk_gov_var_empire_colony_penalty
		}
		IF = { limit = { has_modifier = lrsk_gov_var_empire_colony_favors }
			remove_modifier = lrsk_gov_var_empire_colony_favors
		}
		IF = { limit = { has_modifier = lrsk_gov_var_empire_black_box_drives } # Shouldn't be possible but JIC
			remove_modifier = lrsk_gov_var_empire_black_box_drives
		}
		random_list = {
			# Accept
			50 = {
				modifier = {
					factor = 1.5
					opinion_level = {
						who = event_target:lrsk_sublight_overlord
						level >= good
					}
				}
				modifier = {
					add = 20
					opinion_level = {
						who = event_target:lrsk_sublight_overlord
						level >= excellent
					}
				}
				modifier = {
					factor = 0.5
					opinion_level = {
						who = event_target:lrsk_sublight_overlord
						level <= poor
					}
				}
				modifier = {
					add = -20
					opinion_level = {
						who = event_target:lrsk_sublight_overlord
						level <= terrible
					}
				}
				IF = { limit = { has_country_flag = lrsk_sublight_colony_offered_federation }
					remove_country_flag = lrsk_sublight_colony_offered_vassalization
					set_country_flag = lrsk_sublight_colony_accepted_federation
					# The actual work will be done in event that should execute later.
				}
				ELSE_IF = { limit = { has_country_flag = lrsk_sublight_colony_offered_vassalization }
					remove_country_flag = lrsk_sublight_colony_offered_vassalization
					set_country_flag = lrsk_sublight_colony_accepted_vassalization
					set_subject_of = {
						who = event_target:lrsk_sublight_overlord
						subject_type = vassal
					}
				}
				ELSE = {
					log = "ERROR: Sublight colony somehow got reform offer without offer type set."
				}
				set_country_flag = lrsk_sublight_colony_accepted_reform
				event_target:lrsk_sublight_overlord = {
					country_event = { id = lrsk_gov_var_sublight_origins.9 }
				}
			}
			# Refuse
			50 = {
				modifier = {
					factor = 0.5
					opinion_level = {
						who = event_target:lrsk_sublight_overlord
						level >= good
					}
				}
				modifier = {
					add = -20
					opinion_level = {
						who = event_target:lrsk_sublight_overlord
						level >= excellent
					}
				}
				modifier = {
					factor = 1.5
					opinion_level = {
						who = event_target:lrsk_sublight_overlord
						level <= poor
					}
				}
				modifier = {
					add = 20
					opinion_level = {
						who = event_target:lrsk_sublight_overlord
						level <= terrible
					}
				}
				set_subject_of = { who = none }
				IF = { limit = { has_country_flag = lrsk_sublight_colony_offered_federation }
					remove_country_flag = lrsk_sublight_colony_offered_federation
					set_country_flag = lrsk_sublight_colony_rejected_federation
				}
				ELSE_IF = { limit = { has_country_flag = lrsk_sublight_colony_offered_vassalization }
				remove_country_flag = lrsk_sublight_colony_offered_vassalization
					set_country_flag = lrsk_sublight_colony_rejected_vassalization
				}
				ELSE = {
					log = "ERROR: Sublight colony somehow got reform offer without offer type set."
				}
				set_country_flag = lrsk_sublight_colony_refused_reform
				event_target:lrsk_sublight_overlord = {
					country_event = { id = lrsk_gov_var_sublight_origins.10 }
				}
			}
		}
	}
}

# Colonial Reform Federation Work
# Numbers are out of order because reasons.
# Timing of this call should put at at least 4 days after federation acceptance
country_event = {
	id = lrsk_gov_var_sublight_origins.82
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
		NOT = { any_subject = { has_country_flag = lrsk_sublight_colony_accepted_vassalization } }
	}

	immediate = {
		IF = { limit = { any_subject = { has_country_flag = lrsk_sublight_colony_accepted_federation } }
			# Have to leave existing fed, too complicated otherwise
			IF = { limit = { has_federation = yes }
				IF = { limit = { federation = { has_federation_type = hegemony_federation } } # there should be some consequences...
					set_country_flag = lrsk_sublight_overlord_bailed_on_hegemony
					save_event_target_as = lrsk_sublight_overlord_hegemony_quitter
					federation = { random_member = { 
						limit = { is_federation_leader = yes }
						IF = { limit = { NOT = { is_same_value = event_target:lrsk_sublight_overlord_hegemony_quitter } }
							set_country_flag = lrsk_sublight_member_bailed_suddenly
							save_event_target_as = lrsk_sublight_overlord_hegemon_spurned
							add_opinion_modifier = {
								who = event_target:lrsk_sublight_overlord_hegemony_quitter
								modifier = opinion_lrsk_gov_var_hegmad_sublight
							}
						}
						ELSE = {
							remove_country_flag = lrsk_sublight_overlord_bailed_on_hegemony # not valid if president up and quits
						}
					} }
				}
				leave_alliance = { override_requirements = yes }
			}
			every_subject = {
				limit = { has_country_flag = lrsk_sublight_colony_accepted_federation } # probably redundant, all refusers should be indy
				set_subject_of = { who = none }
				join_alliance = {
					who = event_target:lrsk_sublight_overlord
					override_requirements = yes
				}
			}
			IF = { limit = { has_origin = lrsk_gov_var_origin_sublight_empire }
				federation = { 
					set_federation_type = hegemony_federation
					set_name = random
				}
			}
			set_federation_leader = event_target:lrsk_sublight_overlord
		}
		ELSE_IF = { limit = { any_subject = { has_country_flag = lrsk_sublight_colony_accepted_vassalization } }
			log = "ERROR: Somehow entered sublight reform to fed event despite vassalization chosen?"
		}
		ELSE = {
			# Somehow this was called, fed was chosen, but nothing is ready... try again in a week?
			country_event = {
				id = lrsk_gov_var_sublight_origins.82
				days = 7
			}
		}
	}
}

# Acceptance message
country_event = {
	id = lrsk_gov_var_sublight_origins.9
	title = lrsk_gov_var_sublight_origins.9.name
	desc = lrsk_gov_var_sublight_origins.9.desc
	picture = GFX_evt_signing
	
	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.9.a.fed
		custom_tooltip = lrsk_gov_var_sublight_origins.9.a.fed.tooltip

		trigger = { from = { has_country_flag = lrsk_sublight_colony_accepted_federation } }
	}

	option = {
		name = lrsk_gov_var_sublight_origins.9.a.vas
		custom_tooltip = lrsk_gov_var_sublight_origins.9.a.vas.tooltip

		trigger = { from = { has_country_flag = lrsk_sublight_colony_accepted_vassalization } }
	}
}

# Rejection message
country_event = {
	id = lrsk_gov_var_sublight_origins.10
	title = lrsk_gov_var_sublight_origins.10.name
	desc = lrsk_gov_var_sublight_origins.10.desc
	picture = GFX_evt_alien_propaganda
	
	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
	}

	option = {
		name = lrsk_gov_var_sublight_origins.10.a.empire
		custom_tooltip = lrsk_gov_var_sublight_origins.10.a.empire.tooltip

		trigger = { has_origin = lrsk_gov_var_origin_sublight_empire }

		hidden_effect = { set_country_flag = lrsk_sublight_reform_offer_was_rejected }
	}

	option = {
		name = lrsk_gov_var_sublight_origins.10.a.commonwealth
		custom_tooltip = lrsk_gov_var_sublight_origins.10.a.commonwealth.tooltip

		trigger = { has_origin = lrsk_gov_var_origin_sublight_commonwealth }

		hidden_effect = { set_country_flag = lrsk_sublight_reform_offer_was_rejected }
	}
}

# Housekeeping (Bi-Yearly):
# 1) If a sublight colony becomes independent of the player, they should lose thier nerf modifiers.
# 2) If a sublight colony under the player somehow loses red tape when they should have it, return red tape.
# 3) If a sublight colony under the player somehow becomes some other kind of vassal prior to reforms, return to proper type.
country_event = {
	id = lrsk_gov_var_sublight_origins.100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_colony_loy
			has_origin = lrsk_gov_var_origin_sublight_colony_gsp
			has_origin = lrsk_gov_var_origin_sublight_colony_dis
		}
		NOR = {
			is_subject_type = lrsk_gov_var_sublight_vassal
			is_subject_type = lrsk_gov_var_sublight_satellite
		}
	}

	immediate = {
		#Want to be able to refer to this unambiguously
		save_event_target_as = lrsk_sublight_item_of_business
		set_country_flag = lrsk_sublight_being_dealt_with

		# Check if player is still overlord
		event_target:lrsk_sublight_overlord = {
			IF = { limit = { any_subject = { has_country_flag = lrsk_sublight_being_dealt_with } }
				event_target:lrsk_sublight_item_of_business = { set_country_flag = lrsk_sublight_still_player_vassal }
			}
		}

		IF = { limit = { NOT = { has_country_flag = lrsk_sublight_still_player_vassal } }
			IF = { limit = { has_modifier = lrsk_gov_var_empire_black_box_drives } remove_modifier = lrsk_gov_var_empire_black_box_drives }
			IF = { limit = { has_modifier = lrsk_gov_var_empire_colony_red_tape } remove_modifier = lrsk_gov_var_empire_colony_red_tape }
		}
		ELSE = {
			IF = {
				limit = { NOR = {
					has_modifier = lrsk_gov_var_empire_colony_red_tape
					has_country_flag = lrsk_sublight_overloard_cut_our_red_tape
					event_target:lrsk_sublight_overlord = { NOR = {
						has_country_flag = lrsk_sublight_overlord_abolished_redtape
						has_country_flag = lrsk_sublight_overloard_colonial_system_reformed
					} }
				} }
				add_modifier = { modifier = lrsk_gov_var_empire_colony_red_tape }
			}
			IF = { 
				limit = { NOR = {					
					is_subject_type = lrsk_gov_var_sublight_vassal
					is_subject_type = lrsk_gov_var_sublight_satellite
					event_target:lrsk_sublight_overlord = { has_country_flag = lrsk_sublight_overloard_colonial_system_reformed }
				} }
				save_event_target_as = lrsk_sublight_colony_to_reintegrate
				event_target:lrsk_sublight_overlord = { switch = {
					trigger = has_origin
					lrsk_gov_var_origin_sublight_empire = {
						event_target:lrsk_sublight_colony_to_reintegrate = { set_subject_of = {
							who = event_target:lrsk_sublight_overlord
							subject_type = lrsk_gov_var_sublight_vassal
						} }
					}
					lrsk_gov_var_origin_sublight_commonwealth = {
						event_target:lrsk_sublight_colony_to_reintegrate = { set_subject_of = {
							who = event_target:lrsk_sublight_overlord
							subject_type = lrsk_gov_var_sublight_satellite
						} }
					}
				} }
			}
		}

		remove_country_flag = lrsk_sublight_being_dealt_with
		IF = { limit = { has_country_flag = lrsk_sublight_still_player_vassal }
			remove_country_flag = lrsk_sublight_still_player_vassal
		}
	}
}


# Colonial Corruption
country_event = {
	id = lrsk_gov_var_sublight_origins.200
	hide_window = yes
	is_triggered_only = yes


	trigger = {
		OR = {
			has_origin = lrsk_gov_var_origin_sublight_empire
			has_origin = lrsk_gov_var_origin_sublight_commonwealth
		}
	}

	immediate = {
		switch = {
			trigger = has_modifier
			lrsk_gov_var_empire_colonial_corruption_slight = {
				every_subject = { add_opinion_modifier = {
					who = root
					modifier = opinion_lrsk_gov_var_colcorr_sublight
				} }
				remove_modifier = lrsk_gov_var_empire_colonial_corruption_slight
				add_modifier = {
					modifier = lrsk_gov_var_empire_colonial_corruption_low
					days = 2160 # 6 years
				}
			}
			lrsk_gov_var_empire_colonial_corruption_low = {
				every_subject = { add_opinion_modifier = {
					who = root
					modifier = opinion_lrsk_gov_var_colcorr_sublight
				} }
				remove_modifier = lrsk_gov_var_empire_colonial_corruption_low
				add_modifier = {
					modifier = lrsk_gov_var_empire_colonial_corruption_worrying
					days = 3240 # 9 years
				}
			}
			lrsk_gov_var_empire_colonial_corruption_worrying = {
				every_subject = { add_opinion_modifier = {
					who = root
					modifier = opinion_lrsk_gov_var_colcorr_sublight
				} }
				remove_modifier = lrsk_gov_var_empire_colonial_corruption_worrying
				add_modifier = {
					modifier = lrsk_gov_var_empire_colonial_corruption_crippling
					days = 4860 # 13.5 years
				}
			}
			lrsk_gov_var_empire_colonial_corruption_crippling = {
				every_subject = { 
					add_opinion_modifier = {
						who = root
						modifier = opinion_lrsk_gov_var_colcorr_sublight
					}
					add_opinion_modifier = {
						who = root
						modifier = opinion_lrsk_gov_var_endcorr_sublight
					}
				}
				add_modifier = {
					modifier = lrsk_gov_var_empire_colonial_corruption_entrenched
					days = -1
				}
			}
			default = {
				IF = { limit = { has_modifier = lrsk_gov_var_empire_colonial_corruption_entrenched }
					# Can't make the govt any worse, but at least people will be mad.
					every_subject = { add_opinion_modifier = {
						who = root
						modifier = opinion_lrsk_gov_var_colcorr_sublight
					} }
				}
				ELSE = {
					# No corruption yet
					add_modifier = {
						modifier = lrsk_gov_var_empire_colonial_corruption_slight
						days = 1440 # 4 years
					}
				}
			}		
		}
	}
}
