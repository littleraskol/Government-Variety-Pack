# New Advanced Civics
# Events - Techno-Barbarian
# Author: littleraskol

namespace = lrsk_adv_civ_techbarb

# Starting tech
country_event = {
	id = lrsk_adv_civ_techbarb.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { limit = { has_valid_civic = lrsk_adv_civ_civic_technobarbarism }
			give_technology = { message = no tech = tech_lrsk_adv_civ_ancienttheory }
			give_technology = { message = no tech = tech_lrsk_adv_civ_ancientlearning }
			give_technology = { message = no tech = tech_lrsk_adv_civ_ancientcraft }
		}
	}
}

# TB Sacrilege
country_event = {
	id = lrsk_adv_civ_techbarb.prerev
	title = lrsk_adv_civ_techbarb.prerev.name
	desc = lrsk_adv_civ_techbarb.prerev.desc
	picture = GFX_evt_burning_settlement # TBD change (bar scene?)
	show_sound = event_structural_collapse # TBD change
	location = root.capital_scope
	
	mean_time_to_happen = { days = 7 }

	trigger = {
		has_invalid_civic = lrsk_adv_civ_civic_technobarbarism
		has_policy_flag = lrsk_adv_civ_no_rev
	}

	option = {
		name = lrsk_adv_civ_techbarb.prerev.pride
		custom_tooltip = lrsk_adv_civ_techbarb.prerev.pride.desc
		hidden_effect = {
			add_modifier = { modifier = lrsk_adv_civ_tb_sacrilege days = 271 }
			country_event = {
				id = lrsk_adv_civ_techbarb.rev
				days = 180
				random = 90
			}
		}
	}

	option = {
		name = lrsk_adv_civ_techbarb.prerev.doubt
		custom_tooltip = lrsk_adv_civ_techbarb.prerev.doubt.desc
		hidden_effect = {
			set_policy = {
				policy = lrsk_adv_civ_tech_ritual
				option = lrsk_adv_civ_token_rev
				cooldown = yes
			}
		}
	}
}

# TB revolution
country_event = {
	id = lrsk_adv_civ_techbarb.rev
	title = lrsk_adv_civ_techbarb.revolution.name
	picture = GFX_evt_alien_propaganda
	show_sound = event_planetary_riot
	is_triggered_only = yes
	location = this.capital_scope
	
	desc = {
		trigger = { has_authority = auth_imperial }
		text = lrsk_adv_civ_techbarb.revdyn.desc
	}
	desc = {
		trigger = { has_authority = auth_dictatorial }
		text = lrsk_adv_civ_techbarb.revdic.desc
	}
	desc = {
		trigger = { has_authority = auth_oligarchic }
		text = lrsk_adv_civ_techbarb.revoli.desc
	}
	desc = {
		trigger = { has_authority = auth_corporate }
		text = lrsk_adv_civ_techbarb.revcorp.desc
	}
	
	trigger = {
		has_civic = lrsk_adv_civ_civic_technobarbarism
	}
	
	immediate = {
		remove_modifier = lrsk_adv_civ_tb_sacrilege
	
		add_modifier = {
			modifier = lrsk_adv_civ_tb_revolution
			days = 2521
		}	
		
		force_remove_civic = lrsk_adv_civ_civic_technobarbarism
		
		force_add_civic = lrsk_adv_civ_civic_ref_technobarbarism		
	}

	option = {
		name = lrsk_adv_civ_techbarb.revolution.rebel
		custom_tooltip = lrsk_adv_civ_techbarb.revolution.rebel.desc
	}

	option = {
		name = lrsk_adv_civ_techbarb.revolution.help
		custom_tooltip = lrsk_adv_civ_techbarb.revolution.help.desc
		
		trigger = { is_ai = no }
		
		hidden_effect = { country_event = { id = lrsk_adv_civ_techbarb.revinform } }
	}
	
	after = {		
		country_event = {
			id = lrsk_adv_civ_techbarb.reform
			days = 1800
			random = 720
		}
	}
}

# Inform player of how to deal with this
country_event = {
	id = lrsk_adv_civ_techbarb.revinform
	title = lrsk_adv_civ_techbarb.revinform.name
	title = lrsk_adv_civ_techbarb.revinform.desc
	picture = GFX_evt_alien_propaganda
	is_triggered_only = yes
	
	# just give the player the broad strokes of how this all works...
	
	option = {
		name = lrsk_adv_civ_techbarb.revinform.forward
		custom_tooltip = lrsk_adv_civ_techbarb.revinform.forward.desc
	}
}

# TB revolution ends
country_event = {
	id = lrsk_adv_civ_techbarb.reform
	title = lrsk_adv_civ_techbarb.reform.name
	desc = lrsk_adv_civ_techbarb.reform.desc
	picture = GFX_evt_alien_propaganda # TBD change
	show_sound = event_planetary_riot # TBD change
	is_triggered_only = yes
	location = this.capital_scope
	
	trigger = {
		has_modifier = lrsk_adv_civ_tb_revolution
	}
	
	immediate = {
		remove_modifier = lrsk_adv_civ_tb_revolution
		add_modifier = {
			modifier = lrsk_adv_civ_tb_reformation
			days = 360
		}
	}

	option = {
		name = lrsk_adv_civ_techbarb.reform.hope
	}
	
	after = {
		give_technology = {
			message = yes
			tech = tech_lrsk_adv_civ_scireformation
		}
	}
}

# Tech looting on taking a planet.
# 30% -> Nothing
# 65% -> Some amount of research points 
# 	40% soc, 30% eng, 30% phys (this is because most salvage of ship debris gives phys or eng tech))
# 05% -> Tech rate bonus
# 25% -> Tech rate bonus & kidnap scientist (enemy cap only)
planet_event = {
	id = lrsk_adv_civ_techbarb.200
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		fromfrom = { has_valid_civic = lrsk_adv_civ_civic_technobarbarism }
	}

	immediate = {
		save_event_target_as = lrsk_tb_looting_target
		from = { save_event_target_as = lrsk_tb_enemy_country }
		fromfrom = {
			# Add a flag, but remove it immediately if the nothing option is chosen.
			set_timed_country_flag = {
				flag = lrsk_gvp_tb_tech_stolen
				days = 180
			}
			random_list = {
				30 = {
					modifier = {
						add = -15
						root = { is_capital = yes } # ???
					}
					# Nothing, don't "credit" with any theft
					remove_country_flag = lrsk_gvp_tb_tech_stolen
				}
				65 = {
					modifier = {
						add = -5
						root = { is_capital = yes } # ???
					}
					random_list = {
						40 = {
							country_event = { id = lrsk_adv_civ_techbarb.201 days = 1 }
						}
						30 = {
							country_event = { id = lrsk_adv_civ_techbarb.202 days = 1 }
						}
						30 = {
							country_event = { id = lrsk_adv_civ_techbarb.203 days = 1 }
						}
					}
				}
				5 = {
					modifier = {
						add = -5
						root = { is_capital = yes } # ???
					}
					country_event = { id = lrsk_adv_civ_techbarb.204 }
					#root.owner = { country_event = { id = lrsk_adv_civ_techbarb.206 } } #event to notify?
				}
				0 = {
					modifier = {
						add = 25
						root = { is_capital = yes } # ???
					}
					country_event = { id = lrsk_adv_civ_techbarb.205 }
					#root.owner = { country_event = { id = lrsk_adv_civ_techbarb.207 } } #event to notify?
				}
			}
		}
	}
}

# 40% soc
country_event = {
	id = lrsk_adv_civ_techbarb.201
	title = "lrsk_adv_civ_techbarb.201"
	desc = "lrsk_adv_civ_techbarb.201.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_ground_battle
	location = event_target:lrsk_tb_looting_target

	is_triggered_only = yes
	
	trigger = {
		has_valid_civic = lrsk_adv_civ_civic_technobarbarism
	}

	option = {
		name = EXCELLENT
		add_monthly_resource_mult = {
			resource = society_research
			value = 1.2
			max = 300
			min = 3000
		}
	}
}

# 30% phys
country_event = {
	id = lrsk_adv_civ_techbarb.202
	title = "lrsk_adv_civ_techbarb.202"
	desc = "lrsk_adv_civ_techbarb.202.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_ground_battle
	location = event_target:lrsk_tb_looting_target

	is_triggered_only = yes
	
	trigger = {
		has_valid_civic = lrsk_adv_civ_civic_technobarbarism
	}

	option = {
		name = EXCELLENT
		add_monthly_resource_mult = {
			resource = physics_research
			value = 1.2
			max = 300
			min = 3000
		}
	}
}

# 30% eng
country_event = {
	id = lrsk_adv_civ_techbarb.203
	title = "lrsk_adv_civ_techbarb.203"
	desc = "lrsk_adv_civ_techbarb.203.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_ground_battle
	location = event_target:lrsk_tb_looting_target

	is_triggered_only = yes
	
	trigger = {
		has_valid_civic = lrsk_adv_civ_civic_technobarbarism
	}

	option = {
		name = EXCELLENT
		add_monthly_resource_mult = {
			resource = engineering_research
			value = 1.2
			max = 300
			min = 3000
		}
	}
}

# 05% -> Tech rate bonus
country_event = {
	id = lrsk_adv_civ_techbarb.204
	title = "lrsk_adv_civ_techbarb.204"
	desc = "lrsk_adv_civ_techbarb.204.desc"
	picture = GFX_evt_star_chart
	show_sound = event_activating_unknown_technology
	location = event_target:lrsk_tb_looting_target
	
	is_triggered_only = yes
	
	trigger = {
		has_valid_civic = lrsk_adv_civ_civic_technobarbarism
	}

	option = {
		name = EXCELLENT
		hidden_effect = {
			if = { limit = { has_modifier = lrsk_adv_civ_tb_capped_scientists }
				remove_modifier = lrsk_adv_civ_tb_capped_scientists
			}
		}
		add_modifier = {
			modifier = lrsk_adv_civ_tb_capped_scientists
			days = 1800
		}
	}
}

# 25%, cap only -> kidnap scientist
country_event = {
	id = lrsk_adv_civ_techbarb.205
	title = "lrsk_adv_civ_techbarb.205"
	desc = "lrsk_adv_civ_techbarb.205.desc"
	picture = GFX_evt_star_chart
	show_sound = event_activating_unknown_technology
	location = event_target:lrsk_tb_looting_target
	
	is_triggered_only = yes
	
	trigger = {
		has_valid_civic = lrsk_adv_civ_civic_technobarbarism
	}
	
	immediate = {
		# TBD: complex stuff to kidnap a scientist when invading the enemy capital...
	}

	option = {
		name = EXCELLENT
		hidden_effect = {
			if = { limit = { has_modifier = lrsk_adv_civ_tb_capped_scientists }
				remove_modifier = lrsk_adv_civ_tb_capped_scientists
			}
		}
		add_modifier = {
			modifier = lrsk_adv_civ_tb_capped_scientists
			days = 1800
		}
	}
}


# Add Hidebound trait to scientists on spawn
country_event = {
	id = lrsk_adv_civ_techbarb.trait
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_civic = lrsk_adv_civ_civic_technobarbarism
		from = { leader_class = scientist }
		not = { has_policy_flag = lrsk_adv_civ_no_rev }
	}

	immediate = {
		random_list = {
			25 = {
				modifier = {
					add = 25
					has_policy_flag = lrsk_adv_civ_lapsed_rev
				}
				modifier = {
					add = 50
					has_policy_flag = lrsk_adv_civ_token_rev
				}
				# Nothing
			} 
			75 = {
				modifier = {
					add = -25
					has_policy_flag = lrsk_adv_civ_lapsed_rev
				}
				modifier = {
					add = -50
					has_policy_flag = lrsk_adv_civ_token_rev
				}
				from = { add_trait = lrsk_gov_var_leader_trait_scientist_hidebound }
			}
		}
	}
}

# Periodic cleanup of vanilla materialist faction.
country_event = {
	id = lrsk_adv_civ_techbarb.cleanupmatfac
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_valid_civic = lrsk_adv_civ_civic_technobarbarism
		has_faction = technologist
		has_faction = gvp_tb_innovator
	}
	
	immediate = {
		every_owned_pop = { limit = { member_of_faction = technologist }
			set_pop_faction = gvp_tb_innovator
		}
	}
}

# Periodic cleanup of vanilla spiritualist faction.
country_event = {
	id = lrsk_adv_civ_techbarb.cleanupspifac
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_valid_civic = lrsk_adv_civ_civic_technobarbarism
		has_faction = traditionalist
		has_faction = gvp_tb_ritualist
	}
	
	immediate = {
		every_owned_pop = { limit = { member_of_faction = traditionalist }
			set_pop_faction = gvp_tb_ritualist
		}
	}
}

# Techno-Barbarian Salvage Mission Structure
#
# Frequency
# For Dictatorial and Imperial: Shortly after every new ruler takes power. For Oligarchic, every 50 years or so, but no more than once per ruler.
#

# lrsk_adv_civ_techbarb.dictorimp
# lrsk_adv_civ_techbarb.oligarchy

# Format: Special Project
# Exclusive choice between projects that take up one of the three research paths. Each project has a different set of rewards.
# "Salvage Thinking Machines" (physics)
# "Salvage Art and Records" (society)
# "Salvage Great Engines" (industry)
#

# lrsk_adv_civ_techbarb.pyssalvage
# lrsk_adv_civ_techbarb.socsalvage
# lrsk_adv_civ_techbarb.engsalvage

# Common rewards:
# -Progress towards tech in category
# -Minerals or energy
# -Restore planetary defenses to ruins
# -Restore records for ruins
# -Ruler trait
# -Beneficial planet modifier

# lrsk_adv_civ_techbarb.pystech
# lrsk_adv_civ_techbarb.soctech
# lrsk_adv_civ_techbarb.engtech
# lrsk_adv_civ_techbarb.minerals
# lrsk_adv_civ_techbarb.energy
# lrsk_adv_civ_techbarb.planetdef
# lrsk_adv_civ_techbarb.ruinsrec
# lrsk_adv_civ_techbarb.rulerbonus
# lrsk_adv_civ_techbarb.planetbonus

#
# Physics rewards:
# -Scientist gets "robot assistant" trait
# -Restore labs to ruins
#

# lrsk_adv_civ_techbarb.robotassist
# lrsk_adv_civ_techbarb.ruinslabs

# Society rewards:
# -Recovery of 1-2 xenomorph armies
# -Restore entertainment for ruins.
#

# lrsk_adv_civ_techbarb.xenotroop
# lrsk_adv_civ_techbarb.ruinsent

# Industry rewards:
# -Recovery of 2-4 droid armies
# -Restore industry to ruins
#

# lrsk_adv_civ_techbarb.droidtroop
# lrsk_adv_civ_techbarb.ruinsind

# Risks:
# -Ruler death
# -Ruler gets negative trait
# -Armies to be recovered might turn hostile
# -Release of some virus or poison that affect pops
# -Detrimental planet modifier

# lrsk_adv_civ_techbarb.rulerkill
# lrsk_adv_civ_techbarb.rulerpenalty
# lrsk_adv_civ_techbarb.xenohostile
# lrsk_adv_civ_techbarb.droidhostile
# lrsk_adv_civ_techbarb.bioweapon
# lrsk_adv_civ_techbarb.planetpenalty

# Internal switches:
# -Society: What to try?
# -Options for every common result at random.

# Decision points:
# -Troops found, how to proceed?
