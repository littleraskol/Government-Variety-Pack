# Government Variety Pack
# Events - Uplift Origin
# Author: littleraskol

namespace = lrsk_gov_var_uplift

# Setup
country_event = {
	id = lrsk_gov_var_uplift.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_origin = lrsk_gov_var_origin_uplift
	}

	immediate = {
		set_country_flag = lrsk_gov_var_uplift_nation
		set_country_flag = first_contact_event
		set_country_flag = Story2 # Already encountered spacefarers

		# Call the trait menu
		country_event =  { id = lrsk_gov_var_uplift.30 }
	}
}


# Tutor system finalizations and watchpost system
country_event = {
	id = lrsk_gov_var_uplift.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_origin = lrsk_gov_var_origin_uplift
	}

	immediate = {
		random_country = {
			limit = { has_country_flag = lrsk_uplift_tutor }
			save_event_target_as = lrsk_my_uplift_tutor
			if = {
				limit = { this = { ideal_planet_class = pc_arid } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_arid
				}
			}
			else_if = {
				limit = { this = { ideal_planet_class = pc_desert } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_desert
				}
			}
			else_if = {
				limit = { this = { ideal_planet_class = pc_tropical } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_tropical
				}
			}
			else_if = {
				limit = { this = { ideal_planet_class = pc_continental } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_continental
				}
			}
			else_if = {
				limit = { this = { ideal_planet_class = pc_ocean } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_ocean
				}
			}
			else_if = {
				limit = { this = { ideal_planet_class = pc_tundra } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_tundra
				}
			}
			else_if = {
				limit = { this = { ideal_planet_class = pc_arctic } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_arctic
				}
			}
			else_if = {
				limit = { this = { ideal_planet_class = pc_alpine } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_alpine
				}
			}
			else_if = {
				limit = { this = { ideal_planet_class = pc_savannah } }
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_savannah
				}
			}
			#This is a fallback in case of mod-added or other unexpected planet types.
			else = {
				every_owned_pop = {
					modify_species = {
						species = this
						ideal_planet_class = pc_continental
					}
					species = { save_event_target_as = lrsk_gov_var_new_uplift_tutor_species }
				}
				change_dominant_species = {
					species = event_target:lrsk_gov_var_new_uplift_tutor_species
					change_all = yes
				}
				every_owned_planet = {
					limit = { has_planet_flag = lrsk_uplift_tutor_planet }
					change_pc = pc_continental
				}
			}
			every_owned_planet = {
				limit = {  has_planet_flag = lrsk_uplift_tutor_colony }
				planet_event = { id = game_start.21 }
				planet_event = { id = game_start.22 }
				planet_event = { id = game_start.23 }
			}
			country_event = { id = game_start.6 } #Advanced empire buffs
		}

		this.capital_scope.solar_system = {
			closest_system = {
				limit = {
					any_system_planet = { habitable_planet = no }
					has_owner = no
				}
			
				create_starbase = {
					#name = "Pupil Watchpost"
					size = starbase_starport
					#module = shipyard
					building = listening_post
					owner = event_target:lrsk_my_uplift_tutor
					effect = {
						set_starbase_module = {
							slot = 1
							module = shipyard
						}
						set_starbase_module = {
							slot = 2
							module = trading_hub
						}
					}
				}
				star = { save_event_target_as = lrsk_uplift_watchpost_star }
				create_fleet = {
					name = "Overwatch Squadron"
					effect = {
						set_owner = event_target:lrsk_my_uplift_tutor

						while = {
							count = 4
							create_ship = {
								name = random
								random_existing_design = corvette
							}
						}

						set_location = {
							target = event_target:lrsk_uplift_watchpost_star
							distance = 20
							angle = random
						}
					}
				}
			}
		}
	}
}

# Trait menu selector
country_event = {
	id = lrsk_gov_var_uplift.30
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_origin = lrsk_gov_var_origin_uplift
	}

	immediate = {
		IF = { limit = { is_gestalt = yes } 
			IF = { limit = { has_authority = auth_hive_mind }
				country_event =  { id = lrsk_gov_var_uplift.3 }
			}
			ELSE = {
				country_event =  { id = lrsk_gov_var_uplift.4 }
			}
		}
		ELSE = {
			country_event =  { id = lrsk_gov_var_uplift.5 }
		}
	}
}


# Hive traits
country_event = {
	id = lrsk_gov_var_uplift.3
	title = lrsk_gov_var_uplift.3.name
	desc = lrsk_gov_var_uplift.3.desc

	is_triggered_only = yes

	trigger = {
		has_origin = lrsk_gov_var_origin_uplift
	}

	option = {
		name = lrsk_gov_var_origin_uplift.3.a
		custom_tooltip = lrsk_gov_var_origin_uplift.3.a.tooltip

		tooltip = {
			pop_growth_speed = 0.1
			pop_resettlement_cost_mult = -0.2
			pop_environment_tolerance = 0.1
			leader_age = -5
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = lrsk_gov_var_trait_starborn_hive
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.3.b
		custom_tooltip = lrsk_gov_var_origin_uplift.3.b.tooltip

		tooltip = {
			species_empire_size_mult = -0.10
			planet_jobs_unity_produces_mult = 0.1
			pop_housing_usage_mult = -0.1
			army_defense_damage_mult = 0.5
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = lrsk_gov_var_trait_earthbound_hive
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.3.c
		custom_tooltip = lrsk_gov_var_origin_uplift.3.c.tooltip

		tooltip = {
			army_damage_mult = 0.10
			planet_jobs_simple_drone_produces_mult = 0.05
			planet_jobs_unity_produces_mult = -0.1
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = lrsk_gov_var_trait_proles_hive
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.3.d
		custom_tooltip = lrsk_gov_var_origin_uplift.3.d.tooltip

		tooltip = {
			envoys_add = 1
			country_trust_growth = 0.1
			ship_fire_rate_mult = 0.05
			ship_evasion_mult = 0.1
		}

		hidden_effect = {
			add_modifier = lrsk_gov_var_empire_enlightened_hive
		}
	}
}

# MI traits
country_event = {
	id = lrsk_gov_var_uplift.3
	title = lrsk_gov_var_uplift.3.name
	desc = lrsk_gov_var_uplift.3.desc

	is_triggered_only = yes

	trigger = {
		has_origin = lrsk_gov_var_origin_uplift
	}

	option = {
		name = lrsk_gov_var_origin_uplift.4.a
		custom_tooltip = lrsk_gov_var_origin_uplift.4.a.tooltip

		tooltip = {
			planet_jobs_unity_produces_mult = 0.05
			planet_jobs_physics_research_produces_mult = 0.1
			planet_jobs_engineering_research_produces_mult = 0.1
			planet_jobs_society_research_produces_mult = 0.1
			planet_jobs_simple_drone_produces_mult = -0.05
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = lrsk_gov_var_trait_natural_intellectuals_mech
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.4.b
		custom_tooltip = lrsk_gov_var_origin_uplift.4.b.tooltip

		tooltip = {
			army_damage_mult = 0.10
			planet_jobs_complex_drone_produces_mult = 0.1
			species_leader_exp_gain = -0.33
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = lrsk_gov_var_trait_proles_mech
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.4.c
		custom_tooltip = lrsk_gov_var_origin_uplift.4.c.tooltip

		tooltip = {
			leader_skill_levels = 2
			species_leader_exp_gain = 0.33
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = lrsk_gov_var_trait_conservative_mech
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.4.d
		custom_tooltip = lrsk_gov_var_origin_uplift.4.d.tooltip

		tooltip = {
			ship_archeaological_site_clues_add = 1
			shipclass_science_ship_disengage_mult = 0.25
			ship_anomaly_research_speed_mult = 0.15
			science_ship_survey_speed = 0.2
		}

		hidden_effect = {
			add_modifier = lrsk_gov_var_empire_enlightened_mech
		}
	}
}

# Normal traits
country_event = {
	id = lrsk_gov_var_uplift.3
	title = lrsk_gov_var_uplift.3.name
	desc = lrsk_gov_var_uplift.3.desc

	is_triggered_only = yes

	trigger = {
		has_origin = lrsk_gov_var_origin_uplift
	}

	option = {
		name = lrsk_gov_var_origin_uplift.5.a
		custom_tooltip = lrsk_gov_var_origin_uplift.5.a.tooltip

		tooltip = {
			pop_growth_from_immigration = 0.25
			pop_resettlement_cost_mult = -0.25
			pop_environment_tolerance = 0.1
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = trait_presapient_starborn
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.5.b
		custom_tooltip = lrsk_gov_var_origin_uplift.5.b.tooltip

		tooltip = {
			planet_jobs_energy_produces_mult = 0.1
			army_defense_damage_mult = 0.5
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = trait_presapient_earthbound
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.5.c
		custom_tooltip = lrsk_gov_var_origin_uplift.5.c.tooltip

		tooltip = {
			planet_jobs_unity_produces_mult = 0.05
			planet_jobs_physics_research_produces_mult = 0.1
			planet_jobs_engineering_research_produces_mult = 0.1
			planet_jobs_society_research_produces_mult = 0.1
			planet_jobs_minerals_produces_mult = -0.1
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = trait_presapient_natural_intellectuals
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.5.d
		custom_tooltip = lrsk_gov_var_origin_uplift.5.d.tooltip

		tooltip = {
			army_damage_mult = 0.10
			planet_jobs_minerals_produces_mult = 0.10
			planet_jobs_food_produces_mult = 0.10
			planet_jobs_physics_research_produces_mult = -0.15
			planet_jobs_engineering_research_produces_mult = -0.15
			planet_jobs_society_research_produces_mult = -0.15
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = trait_presapient_proles
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.5.e
		custom_tooltip = lrsk_gov_var_origin_uplift.5.e.tooltip

		tooltip = {
			pop_happiness = 0.05
			pop_government_ethic_attraction = 0.25
			species_leader_exp_gain = -0.33
		}

		hidden_effect = {
			every_owned_pop = {
				modify_species = {
					species = this
					add_trait = trait_presapient_conservative
				}
				species = { save_event_target_as = lrsk_gov_var_new_uplift_pupil_species }
			}
			change_dominant_species = {
				species = event_target:lrsk_gov_var_new_uplift_pupil_species
				change_all = yes
			}
		}
	}

	option = {
		name = lrsk_gov_var_origin_uplift.5.f
		custom_tooltip = lrsk_gov_var_origin_uplift.5.f.tooltip

		tooltip = {
			envoys_add = 1
			country_trust_growth = 0.1
			ship_anomaly_research_speed_mult = 0.15
			science_ship_survey_speed = 0.2
		}

		hidden_effect = {
			add_modifier = lrsk_gov_var_empire_enlightened
		}
	}
}

