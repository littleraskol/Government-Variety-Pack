# New Advanced Civics
# Agreement Term Values
# Author: littleraskol

### Discrete Terms ###

## ImpEcon Terms

# Default non-spec subject option.
lrsk_gvp_special_service_loyalty_null = {
	term = lrsk_gvp_impecon

	possible = {
		target = { lrsk_is_impecon_special_vassal = no }
	}
}

# Effects of being a special economic subject.
# This is for the various stacking bonus modifiers the overlord gets.
# Otherwise, it seems loyalty is actually too easy to come by for these subject types...
lrsk_gvp_special_service_loyalty_effects = {
	term = lrsk_gvp_impecon

	target_modifier = {
		monthly_loyalty = -1
	}

	activate_effect = {
		owner = { country_event = { id = lrsk_gov_var_impecon.3 } }
	}

	deactivate_effect = {
		owner = { country_event = { id = lrsk_gov_var_impecon.3 } }
	}

	possible = {
		target = { lrsk_is_impecon_special_vassal = yes }
	}
}

## Colonial Chartering terms

# Default non-spec subject option.
lrsk_gvp_chartered_colony_null = {
	term = lrsk_gvp_chartering

	possible = {
		target = { NOT = { is_subject_with_preset = { PRESET = preset_lrsk_gov_var_subject_chartered_company } } }
	}
}

# Effects of being a chartered colony.
# They seem too negative overall, so I will give them a little boost and accompanying loyalty bonus
# This may be a scaling/non-hidden term in the future.
lrsk_gvp_chartered_colony_effects = {
	term = lrsk_gvp_chartering

	unique_target_modifier = {
		trade_value_mult = 0.1
		monthly_loyalty = 1
	}

	activate_effect = {
		owner = {
			country_event = { id = lrsk_gov_var_chartered.3 }
			set_relation_flag = { who = prev.target flag = lrsk_chartered_this_company }
			save_event_target_as = lrsk_chartering_agent
			species = { save_event_target_as = lrsk_chartering_agent_species }
		}
		target = {
			store_country_backup_data = {
				ethics = yes
				government = yes
				name = yes
			}

			switch = {
				trigger = has_ethic
				ethic_fanatic_authoritarian = {
					country_remove_ethic = ethic_fanatic_authoritarian
					shift_ethic = ethic_authoritarian
				}
				ethic_fanatic_egalitarian = {
					country_remove_ethic = ethic_fanatic_egalitarian
					shift_ethic = ethic_egalitarian
				}
			}
			change_government = {
				authority = auth_corporate
				civics = {
					civic = lrsk_gov_var_civic_mc_chartered_company
					civic = random
				}
			}
			set_name = random # Fixes some naming issues

			IF = { 
				limit = { NOT = { 
					has_opinion_modifier = {
						who = event_target:lrsk_chartering_agent
						modifier = opinion_lrsk_gov_var_colonial_mission
					}
				} }
				add_opinion_modifier = {
					who = event_target:lrsk_chartering_agent
					modifier = opinion_lrsk_gov_var_colonial_mission
				}
			}

			# This flag set when establishing foreign rule.
			# Change the dominant species and "add" a pop of that species to the home planet
			# Make xenophobic and replace ruler (with new dominant species ruler)
			IF = { limit = { has_country_flag = lrsk_alien_rule_puppet }
				save_event_target_as = lrsk_subject_to_charter
				species = { save_event_target_as = lrsk_chartering_usurped_species }
		
				# reaction of the usurped
				country_event = { id = lrsk_gov_var_chartered.21 }
		
				# This ensures a "ruler class" pop (if possible) of the new dominant species "displaces" a native pop
				capital_scope = {
					IF = {
						limit = {
							any_owned_pop = {
								has_job_category = ruler
								NOT = { is_same_species = event_target:lrsk_chartering_agent }
							}
						}
						random_owned_pop = {
							limit = {
								has_job_category = ruler
								NOT = { is_same_species = event_target:lrsk_chartering_agent }
							}
							change_species = event_target:lrsk_chartering_agent_species
						}
						create_pop = {
							species = event_target:lrsk_chartering_usurped_species
							ethos = {
								ethic = ethic_xenophile
							}
						}	
					}
					ELSE_IF = {
						limit = {
							any_owned_pop = {
								has_job_category = specialist
								NOT = { is_same_species = event_target:lrsk_chartering_agent }
							}
						}
						random_owned_pop = { 
							limit = {
								has_job_category = specialist
								NOT = { is_same_species = event_target:lrsk_chartering_agent }
							}
							change_species = event_target:lrsk_chartering_agent_species
						}
						create_pop = {
							species = event_target:lrsk_chartering_usurped_species
							ethos = {
								ethic = ethic_xenophile
							}
						}
					}
					ELSE_IF = {
						limit = { any_owned_pop = { NOT = { is_same_species = event_target:lrsk_chartering_agent } } }
						random_owned_pop = {
							limit = { NOT = { is_same_species = event_target:lrsk_chartering_agent } }
							change_species = event_target:lrsk_chartering_agent_species
						}
						create_pop = {
							species = event_target:lrsk_chartering_usurped_species
							ethos = {
								ethic = ethic_xenophile
							}
						}
					}
				}
		
				change_dominant_species = { species = event_target:lrsk_chartering_agent_species }
		
				shift_ethic = ethic_xenophobe
		
				ruler = {
					kill_leader = {
						show_notification = no
						fire = yes
					}
				}
		
				# prevents immediate mass enslavement of deposed species pops (fucking yikes)
				every_owned_pop = { limit = { NOT = { is_same_species = event_target:lrsk_chartering_agent } }		
					set_citizenship_type = {
						country = prev
						type = citizenship_limited
						cooldown = yes
					}
				}
			}			
		}
	}

	deactivate_effect = {
		owner = {
			country_event = { id = lrsk_gov_var_chartered.3 }
			remove_relation_flag = { who = prev.target flag = lrsk_chartered_this_company }
		}
		target = {
			restore_country_backup_data = yes
			IF = { 
				limit = {
					has_opinion_modifier = {
						who = this.overlord
						modifier = opinion_lrsk_gov_var_colonial_mission
					}
				}
				remove_opinion_modifier = {
					who = this.overlord
					modifier = opinion_lrsk_gov_var_colonial_mission
				}
			}

			# deal with alien rule stuff
			lrsk_clear_country_flag = { FLAG = lrsk_alien_rule_puppet }
			IF = { limit = { any_owned_species = { has_species_flag = lrsk_usurped_indigenes } }
				random_owned_species = { limit = { has_species_flag = lrsk_usurped_indigenes }
					save_event_target_as = lrsk_chartering_usurped_species
					remove_species_flag = lrsk_usurped_indigenes
				}

				change_dominant_species = { species = event_target:lrsk_chartering_usurped_species }
		
				ruler = {
					kill_leader = {
						show_notification = no
						fire = yes
					}
				}
			}
		}
	}

	possible = {
		target = { is_subject_with_preset = { PRESET = preset_lrsk_gov_var_subject_chartered_company } }
	}
}

## Alien rule terms

# Default (home rule)
lrsk_gvp_home_rule = {
	term = lrsk_gvp_alien_puppet_regime

	possible = {
		target = { NOT = { has_country_flag = lrsk_alien_rule_puppet } }
	}
}

# Foreign puppet regime
lrsk_gvp_foreign_regime = {
	term = lrsk_gvp_alien_puppet_regime

	possible = {
		target = { has_country_flag = lrsk_alien_rule_puppet }
	}

	target_modifier = {
		monthly_loyalty = 1.5
	}

	loyalty_change = 15
}

### Resource Terms ###

@lrsk_subsidy_multiplier = 0.15
@lrsk_subsidy_multiplier_trophy = 0.4
@lrsk_subsidy_multiplier_advanced = 0.25
@lrsk_subsidy_multiplier_strategic = 0.5

@lrsk_subsidy_monthly_multiplier = 1.5
@lrsk_subsidy_monthly_multiplier_trophy = 4
@lrsk_subsidy_monthly_multiplier_advanced = 2.5

# When changing the maximum and minimum values here the following should also be updated:
# In agreement_negotiation_view.gui
#	maxValue =
#	minValue =
#	stepSize =
# In 00_defines.txt:
#	AGREEMENT_RESOURCE_SUBSIDIES_MIN
#	AGREEMENT_RESOURCE_SUBSIDIES_MAX

@lrsk_default_min = 0.0
@lrsk_min_10 = 0.1
@lrsk_min_15 = 0.15
@lrsk_min_20 = 0.2
@lrsk_default_max = 0.6
@lrsk_spec_max = 0.75


lrsk_gvp_special_resource_tax_influence = {
	term = resource_subsidies
	resources = {
		influence
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier_trophy
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier_trophy

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
		target = { has_modifier = lrsk_gov_var_empire_impecon_trophy_vs }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_trophy
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_trophy
		}
	}
}

lrsk_gvp_special_resource_tax_unity = {
	term = resource_subsidies
	resources = {
		unity
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier_trophy
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier_trophy

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
		target = { has_modifier = lrsk_gov_var_empire_impecon_trophy_vs }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_trophy
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_trophy
		}
	}
}

lrsk_gvp_special_resource_tax_minerals = {
	term = resource_subsidies
	resources = {
		minerals
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_prospector
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_prospector
		}
	}
}

lrsk_gvp_special_resource_tax_food = {
	term = resource_subsidies
	resources = {
		food
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_market
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_market
		}
	}
}

lrsk_gvp_special_resource_tax_energy = {
	term = resource_subsidies
	resources = {
		energy
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_foundry
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_foundry
		}
	}
}

lrsk_gvp_special_resource_tax_alloys = {
	term = resource_subsidies
	resources = {
		alloys
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier_advanced
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier_advanced

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_foundry
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_foundry
		}
	}
}

lrsk_gvp_special_resource_tax_consumer_goods = {
	term = resource_subsidies
	resources = {
		consumer_goods
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier_advanced
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier_advanced

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_market
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_market
		}
	}
}

lrsk_gvp_special_resource_tax_volatile_motes = {
	term = resource_subsidies
	resources = {
		volatile_motes
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier_strategic
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_prospector
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_prospector
		}
	}
}

lrsk_gvp_special_resource_tax_exotic_gases = {
	term = resource_subsidies
	resources = {
		exotic_gases
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier_strategic
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_prospector
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_prospector
		}
	}
}

lrsk_gvp_special_resource_tax_rare_crystals = {
	term = resource_subsidies
	resources = {
		rare_crystals
	}

	subsidy_multiplier = @lrsk_subsidy_multiplier_strategic
	subsidy_monthly_multiplier = @lrsk_subsidy_monthly_multiplier

	potential = {
		owner = { has_valid_civic = lrsk_gov_var_civic_imperial_economy }
	}

	resource_min = {
		base = @lrsk_default_min

		modifier = {
			set = @lrsk_min_15
			agreement_preset = preset_lrsk_gvp_vassal_prospector
		}
	}

	resource_max = {
		base = @lrsk_default_max

		modifier = {
			set = @lrsk_spec_max
			agreement_preset = preset_lrsk_gvp_vassal_prospector
		}
	}
}